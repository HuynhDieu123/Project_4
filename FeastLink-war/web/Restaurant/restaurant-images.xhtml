<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<ui:composition
         template="/Restaurant/layout-manager.xhtml"
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="jakarta.faces.html"
        xmlns:f="jakarta.faces.core"
        
        xmlns:ui="jakarta.faces.facelets">

    <!-- ===== PAGE TITLE ===== -->
    <ui:define name="title">
        Restaurant Images – FeastLink
    </ui:define>

    <!-- ===== TOP LEFT HEADER ===== -->
    <ui:define name="header">
        <div class="flex items-center gap-3">
            <div class="h-10 w-10 rounded-full bg-[rgba(212,175,55,0.1)] flex items-center justify-center">
                <span class="material-symbols-outlined text-[var(--secondary)]">photo_library</span>
            </div>
            <div>
                <h1 class="text-lg font-semibold text-text-main-light">
                    Restaurant Images
                </h1>
                <p class="text-xs text-text-secondary-light">
                    Manage your primary banner and gallery images for this restaurant.
                </p>
            </div>
        </div>
    </ui:define>

    <!-- ===== MAIN CONTENT ===== -->
    <ui:define name="content">

        <!-- QUAN TRỌNG: phải có enctype="multipart/form-data" -->
        <h:form id="imagesForm" enctype="multipart/form-data">

            <!-- Global messages -->
            <h:messages id="messages"
                        globalOnly="true"
                        layout="list"
                        styleClass="mb-4 space-y-2"
                        infoClass="text-sm px-3 py-2 rounded-md bg-green-50 text-green-700 border border-green-200"
                        errorClass="text-sm px-3 py-2 rounded-md bg-red-50 text-red-700 border border-red-200"
                        warnClass="text-sm px-3 py-2 rounded-md bg-yellow-50 text-yellow-800 border border-yellow-200" />

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

                <!-- ===== LEFT: Upload form ===== -->
                <div class="lg:col-span-1">
                    <div class="bg-card-light rounded-2xl shadow-subtle border border-border-light p-6 space-y-5">
                        <h2 class="text-base font-semibold text-text-main-light mb-1">
                            Upload new image
                        </h2>
                        <p class="text-xs text-text-secondary-light mb-2">
                            Choose a high quality image of your hall, stage or decor.
                            You can mark one image as the
                            <span class="font-semibold text-champagne-gold">primary banner</span>.
                        </p>

                        <!-- File (ĐÃ SỬA) -->
                        <div class="space-y-1">
                            <label class="text-xs font-medium text-text-secondary-light">
                                Select image file
                            </label>

                            <!-- CHỈ dùng h:inputFile, KHÔNG dùng input type="file" thường -->
                            <h:inputFile id="imageFile"
                                         value="#{restaurantImagesBean.imageFile}"
                                         styleClass="block w-full text-xs text-gray-700
                                                     file:mr-4 file:px-3 file:py-1.5
                                                     file:rounded-full file:border-0
                                                     file:text-xs file:font-semibold
                                                     file:bg-[var(--secondary-soft)] file:text-[var(--primary)]
                                                     hover:file:bg-[var(--secondary)] hover:file:text-white
                                                     rounded-md border border-border-light bg-background-soft"/>
                            <h:message for="imageFile"
                                       styleClass="text-[11px] text-red-600 mt-1 block"/>
                        </div>

                        <!-- Caption -->
                        <div class="space-y-1">
                            <label class="text-xs font-medium text-text-secondary-light">
                                Caption (optional)
                            </label>
                            <h:inputText value="#{restaurantImagesBean.caption}"
                                         styleClass="mt-1 block w-full rounded-lg border border-border-light bg-background-soft text-xs px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--secondary)] focus:border-transparent"
                                         maxlength="255" />
                        </div>

                        <!-- Primary toggle -->
                        <div class="flex items-start gap-2 mt-2">
                            <h:selectBooleanCheckbox value="#{restaurantImagesBean.primaryImage}"
                                                     styleClass="mt-0.5 rounded border-border-light text-[var(--secondary)] focus:ring-[var(--secondary)]" />
                            <div class="text-xs text-text-secondary-light">
                                <p class="font-medium text-text-main-light">
                                    Use as primary banner
                                </p>
                                <p>
                                    If checked, this image will replace the current
                                    primary banner on your restaurant page.
                                </p>
                            </div>
                        </div>

                        <div class="pt-3">
                           <h:commandButton value="Upload image"
                 action="#{restaurantImagesBean.uploadImage}"
                 styleClass="
                    inline-flex items-center justify-center px-5 py-2.5 rounded-full
                    text-xs font-semibold tracking-wide
                    bg-cta-orange text-white
                    shadow-sm
                    focus:outline-none
                    cursor-pointer
                 " />

                        </div>
                    </div>
                </div>

                <!-- ===== RIGHT: Preview ===== -->
                <div class="lg:col-span-2 space-y-8">

                    <!-- Primary banner -->
                    <div class="bg-card-light rounded-2xl shadow-subtle border border-border-light overflow-hidden">
                        <div class="flex items-center justify-between px-6 pt-4 pb-3 border-b border-border-light">
                            <div>
                                <h3 class="text-sm font-semibold text-text-main-light">
                                    Primary banner
                                </h3>
                                <p class="text-xs text-text-secondary-light">
                                    This image is shown as the hero banner on your FeastLink restaurant page.
                                </p>
                            </div>
                            <span class="inline-flex items-center rounded-full px-3 py-1 text-[11px] font-semibold
                                         bg-[rgba(212,175,55,0.12)] text-[var(--secondary)] border border-[rgba(212,175,55,0.4)]">
                                Primary
                            </span>
                        </div>

                        <h:panelGroup rendered="#{not empty restaurantImagesBean.primaryBanner}">
                            <div class="w-full aspect-[16/6] bg-background-soft overflow-hidden">
                                <h:graphicImage value="#{restaurantImagesBean.resolveImageUrl(restaurantImagesBean.primaryBanner)}"
                                                styleClass="w-full h-full object-cover" />
                            </div>
                            <div class="px-6 py-4 flex items-center justify-between">
                                <div class="space-y-1">
                                    <p class="text-sm font-medium text-text-main-light">
                                        <h:outputText value="#{empty restaurantImagesBean.primaryBanner.caption ? 'No caption' : restaurantImagesBean.primaryBanner.caption}" />
                                    </p>
                                    <p class="text-[11px] text-text-secondary-light">
                                        Uploaded on
                                        <h:outputText value="#{restaurantImagesBean.primaryBanner.createdAt}">
                                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
                                        </h:outputText>
                                    </p>
                                </div>
                                <div>
                                    <h:commandButton value="Delete"
                                                     action="#{restaurantImagesBean.deleteImage(restaurantImagesBean.primaryBanner)}"
                                                     styleClass="inline-flex items-center rounded-full border border-red-200 bg-red-50 px-3 py-1.5 text-[11px] font-semibold text-red-600 hover:bg-red-100" />
                                </div>
                            </div>
                        </h:panelGroup>

                        <h:panelGroup rendered="#{empty restaurantImagesBean.primaryBanner}">
                            <div class="px-6 py-6 text-xs text-text-secondary-light">
                                No primary banner yet. Upload an image and check
                                <span class="font-semibold text-champagne-gold">“Use as primary banner”</span>
                                to set it here.
                            </div>
                        </h:panelGroup>
                    </div>

                    <!-- Other images -->
                    <div class="space-y-3">
                        <h3 class="text-sm font-semibold text-text-main-light">
                            Other images
                        </h3>
                        <h:panelGroup rendered="#{empty restaurantImagesBean.otherImages}">
                            <p class="text-xs text-text-secondary-light">
                                You have no additional images. Upload more photos to showcase different halls,
                                setups or decorations.
                            </p>
                        </h:panelGroup>

                        <h:panelGroup rendered="#{not empty restaurantImagesBean.otherImages}">
                            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-5">

                                <ui:repeat value="#{restaurantImagesBean.otherImages}" var="img">
                                    <div class="bg-card-light rounded-2xl border border-border-light shadow-subtle overflow-hidden flex flex-col">
                                        <div class="w-full aspect-video bg-background-soft overflow-hidden">
                                            <h:graphicImage value="#{restaurantImagesBean.resolveImageUrl(img)}"
                                                            styleClass="w-full h-full object-cover" />
                                        </div>
                                        <div class="px-4 py-3 flex-1 flex flex-col justify-between">
                                            <div class="space-y-1">
                                                <p class="text-xs font-medium text-text-main-light">
                                                    <h:outputText value="#{empty img.caption ? 'No caption' : img.caption}" />
                                                </p>
                                                <p class="text-[11px] text-text-secondary-light">
                                                    Uploaded on
                                                    <h:outputText value="#{img.createdAt}">
                                                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
                                                    </h:outputText>
                                                </p>
                                            </div>
                                            <div class="mt-3 flex justify-between items-center">
                                                <span class="text-[11px] text-text-secondary-light">
                                                    Sort order:
                                                    <h:outputText value="#{img.sortOrder != null ? img.sortOrder : 0}" />
                                                </span>
                                                <h:commandButton value="Delete"
                                                                 action="#{restaurantImagesBean.deleteImage(img)}"
                                                                 styleClass="inline-flex items-center rounded-full border border-red-200 bg-red-50 px-3 py-1.5 text-[11px] font-semibold text-red-600 hover:bg-red-100" />
                                            </div>
                                        </div>
                                    </div>
                                </ui:repeat>

                            </div>
                        </h:panelGroup>
                    </div>

                </div>
            </div>
        </h:form>

    </ui:define>
</ui:composition>
