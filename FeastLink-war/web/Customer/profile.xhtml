<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets">

<h:head>
    <title>FeastLink – Profile</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" type="text/css"
          href="#{request.contextPath}/css/profile.css" />
     <script src="https://cdn.tailwindcss.com"></script>

        <!-- Lucide Icons CDN -->
        <script src="https://unpkg.com/lucide@latest"></script>
</h:head>

<h:body>
    <div id="top"></div>

    <!-- HEADER -->
    <ui:include src="/layout/header.xhtml" />

    <div class="profile-shell">
        <h:form id="profileForm" enctype="multipart/form-data">

            <!-- Nếu muốn giữ message thì vẫn để, nhưng redirect sẽ không giữ lại; có thể bỏ nếu thấy thừa -->
            <h:messages style="margin:0 auto 16px;max-width:1100px;font-size:12px;"
                        infoClass="msg-info"
                        errorClass="msg-error"
                        warnClass="msg-warn" />

            <div class="profile-card">

                <!-- LEFT COLUMN -->
                <div class="profile-left">
                    <div class="profile-left-inner">

                        <div class="profile-avatar-wrap">
                            <div class="profile-avatar-circle">
                                <!-- ĐÃ CÓ AVATAR -->
                                <ui:fragment rendered="#{not empty profileBean.avatarSrc}">
                                    <img src="#{request.contextPath}#{profileBean.avatarSrc}"
                                         alt="Avatar"
                                         style="width:100%;height:100%;border-radius:999px;object-fit:cover;display:block;" />
                                </ui:fragment>

                                <!-- CHƯA CÓ AVATAR: initials -->
                                <ui:fragment rendered="#{empty profileBean.avatarSrc}">
                                    <span class="profile-avatar-initial">
                                        #{profileBean.initials}
                                    </span>
                                </ui:fragment>
                            </div>

                            <div style="margin-top:10px;">
                                <span class="profile-avatar-btn">Upload avatar</span>
                            </div>

                            <div style="margin-top:6px;font-size:11px;color:#9CA3AF;">
                                <h:inputFile value="#{profileBean.avatarPart}">
                                    <f:passThroughAttribute name="accept" value="image/*" />
                                </h:inputFile>
                            </div>
                        </div>

                        <div class="profile-main-info">
                            <p class="profile-name">
                                <h:outputText value="#{profileBean.fullName}" />
                            </p>
                            <p class="profile-email">
                                <h:outputText value="#{profileBean.email}" />
                            </p>
                            <div class="profile-badge">
                                FeastLink Member
                            </div>

                            <div class="profile-stats">
                                <div class="profile-stat-item">
                                    <span>Total bookings</span>
                                    <span class="value">0</span>
                                </div>
                                <div class="profile-stat-item">
                                    <span>Favourites</span>
                                    <span class="value">0</span>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- RIGHT COLUMN -->
                <div class="profile-right">
                    <div class="profile-right-header">
                        <h2 class="profile-title">Profile</h2>
                        <p class="profile-subtitle">
                            Update your basic information used for FeastLink bookings.
                        </p>
                    </div>

                    <div class="profile-section">
                        <div class="profile-section-header">
                            <span class="dot"></span>
                            <span>Basic information</span>
                        </div>

                        <div class="profile-grid">
                            <div class="profile-field">
                                <label class="profile-label">Full name</label>
                                <h:inputText value="#{profileBean.fullName}"
                                             styleClass="profile-input" />
                            </div>

                            <div class="profile-field">
                                <label class="profile-label">Phone</label>
                                <h:inputText value="#{profileBean.phone}"
                                             styleClass="profile-input" />
                            </div>

                            <div class="profile-field">
                                <label class="profile-label">Email</label>
                                <h:inputText value="#{profileBean.email}"
                                             styleClass="profile-input" />
                            </div>

                            <div class="profile-field">
                                <label class="profile-label">City</label>
                                <h:selectOneMenu value="#{profileBean.cityId}"
                                                 styleClass="profile-input">
                                    <f:selectItem itemLabel="Select city" noSelectionOption="true" />
                                    <f:selectItems value="#{profileBean.cities}"
                                                   var="c"
                                                   itemValue="#{c.cityId}"
                                                   itemLabel="#{c.name}" />
                                </h:selectOneMenu>
                            </div>

                            <div class="profile-field" style="grid-column:1 / -1;">
                                <label class="profile-label">Address</label>
                                <h:inputText value="#{profileBean.address}"
                                             styleClass="profile-input" />
                            </div>
                        </div>

                        <div class="profile-actions">
                            <h:commandButton value="Save profile"
                                             action="#{profileBean.saveProfile}"
                                             styleClass="btn-secondary" />
                            <h:commandButton value="Back to home"
                                             immediate="true"
                                             action="/Customer/index?faces-redirect=true"
                                             styleClass="btn-link" />
                        </div>
                    </div>
                </div>

            </div>
        </h:form>
    </div>
</h:body>
</html>
