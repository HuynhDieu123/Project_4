<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets">

    <h:head>
        <meta charset="UTF-8" />
        <title>FeastLink System Feedback</title>
         <!-- Tailwind CDN -->
        <script src="https://cdn.tailwindcss.com"></script>

        <!-- Lucide Icons CDN -->
        <script src="https://unpkg.com/lucide@latest"></script>


        <style type="text/css">
            :root {
                --fl-primary: #020617;
                --fl-primary-soft: #0f172a;
                --fl-gold: #d4af37;
                --fl-gold-soft: #facc6b;
                --fl-border: #e5e7eb;
                --fl-bg: #f9fafb;
                --fl-card-bg: #ffffff;
                --fl-danger: #ef4444;
                --fl-success: #22c55e;
                --fl-warn: #f97316;
                --fl-text-main: #111827;
                --fl-text-muted: #6b7280;
            }

            body {
                margin: 0;
            }

            .fl-feedback-body {
                margin: 0;
                font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
                background: radial-gradient(circle at top, #fef3c7 0, #f9fafb 40%, #f3f4f6 100%);
                color: var(--fl-text-main);
            }

            .fl-feedback-page {
                max-width: 1160px;
                margin: 0 auto;
                padding: 0 16px 40px;
            }

            .fl-feedback-header {
                margin-bottom: 24px;
            }

            .fl-feedback-badge {
                display: inline-flex;
                align-items: center;
                gap: 8px;
                padding: 4px 10px;
                border-radius: 999px;
                font-size: 11px;
                letter-spacing: 0.12em;
                text-transform: uppercase;
                background: rgba(250, 204, 21, 0.12);
                color: #92400e;
                border: 1px solid rgba(212, 175, 55, 0.4);
            }

            .fl-feedback-badge::before {
                content: "";
                width: 6px;
                height: 6px;
                border-radius: 999px;
                background: linear-gradient(135deg, var(--fl-gold), #fbbf24);
                box-shadow: 0 0 0 4px rgba(250, 204, 21, 0.25);
            }

            .fl-feedback-title {
                margin: 10px 0 6px;
                font-size: 24px;
                font-weight: 700;
                color: var(--fl-primary);
            }

            .fl-feedback-subtitle {
                margin: 0;
                max-width: 840px;
                font-size: 14px;
                color: var(--fl-text-muted);
            }

            .fl-feedback-layout {
                display: grid;
                grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.3fr);
                gap: 18px;
            }

            .fl-feedback-left,
            .fl-feedback-right {
                background: var(--fl-card-bg);
                border-radius: 18px;
                border: 1px solid rgba(148, 163, 184, 0.18);
                box-shadow:
                    0 22px 45px rgba(15, 23, 42, 0.12),
                    0 0 0 1px rgba(148, 163, 184, 0.12);
                padding: 18px 20px 20px;
            }

            .fl-section-title {
                display: flex;
                align-items: center;
                gap: 8px;
                font-size: 15px;
                font-weight: 600;
                margin: 0 0 6px;
                color: var(--fl-primary);
            }

            .fl-dot {
                width: 6px;
                height: 18px;
                border-radius: 999px;
                background: linear-gradient(180deg, var(--fl-gold-soft), var(--fl-gold));
            }

            .fl-section-desc {
                margin: 0 0 14px;
                font-size: 12px;
                color: var(--fl-text-muted);
            }

            .fl-field {
                margin-bottom: 14px;
            }

            .fl-label {
                display: block;
                font-size: 12px;
                font-weight: 600;
                color: var(--fl-primary-soft);
                margin-bottom: 4px;
            }

            .fl-input,
            .fl-select,
            .fl-textarea {
                width: 100%;
                box-sizing: border-box;
                padding: 9px 11px;
                border-radius: 10px;
                border: 1px solid var(--fl-border);
                font-size: 13px;
                outline: none;
                background: #f9fafb;
                transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
            }

            .fl-input:focus,
            .fl-select:focus,
            .fl-textarea:focus {
                border-color: var(--fl-gold-soft);
                box-shadow: 0 0 0 1px rgba(250, 204, 21, 0.35);
                background: #ffffff;
            }

            .fl-input-readonly,
            .fl-textarea-readonly {
                background: #f3f4f6;
                cursor: default;
            }

            .fl-textarea {
                resize: vertical;
                min-height: 84px;
            }

            .fl-help-text {
                display: block;
                margin-top: 4px;
                font-size: 11px;
                color: var(--fl-text-muted);
            }

            .fl-grid-2 {
                display: grid;
                grid-template-columns: repeat(2, minmax(0, 1fr));
                gap: 10px;
            }

            .fl-actions {
                display: flex;
                justify-content: flex-end;
                gap: 8px;
                margin-top: 16px;
            }

            .fl-btn {
                border-radius: 999px;
                border: none;
                padding: 9px 18px;
                font-size: 13px;
                font-weight: 600;
                cursor: pointer;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                white-space: nowrap;
                transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.15s ease;
            }

            .fl-btn-primary {
                background: linear-gradient(135deg, var(--fl-gold), #fbbf24);
                color: #1f2933;
                box-shadow: 0 10px 20px rgba(234, 179, 8, 0.35);
            }

            .fl-btn-primary:hover {
                transform: translateY(-1px);
                box-shadow: 0 14px 28px rgba(234, 179, 8, 0.45);
            }

            .fl-btn-primary[disabled] {
                opacity: 0.5;
                cursor: not-allowed;
                box-shadow: none;
            }

            .fl-btn-ghost {
                background: transparent;
                color: var(--fl-text-muted);
                border: 1px solid rgba(148, 163, 184, 0.5);
            }

            .fl-btn-ghost:hover {
                background: rgba(148, 163, 184, 0.06);
            }

            .fl-status-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin: 6px 0 16px;
            }

            .fl-status-label {
                font-size: 12px;
                color: var(--fl-text-muted);
            }

            .fl-status-pill {
                display: inline-flex;
                align-items: center;
                gap: 6px;
                padding: 4px 10px;
                border-radius: 999px;
                background: rgba(16, 185, 129, 0.06);
                border: 1px solid rgba(16, 185, 129, 0.4);
            }

            .fl-status-dot {
                width: 7px;
                height: 7px;
                border-radius: 999px;
                background: #22c55e;
                box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.2);
            }

            .fl-status-text {
                font-size: 11px;
                font-weight: 600;
                color: #065f46;
            }

            .fl-tips {
                margin-top: 16px;
                padding-top: 10px;
                border-top: 1px dashed rgba(148, 163, 184, 0.6);
            }

            .fl-tips-title {
                font-size: 12px;
                font-weight: 600;
                margin: 0 0 6px;
                color: var(--fl-primary-soft);
            }

            .fl-tips-list {
                margin: 0;
                padding-left: 18px;
                font-size: 11px;
                color: var(--fl-text-muted);
            }

            .fl-tips-list li {
                margin-bottom: 4px;
            }

            .fl-messages {
                margin-top: 10px;
                font-size: 12px;
            }

            .fl-message-error {
                color: var(--fl-danger);
            }

            .fl-message-info {
                color: var(--fl-success);
            }

            .fl-message-warn {
                color: var(--fl-warn);
            }

            .fl-login-hint {
                margin-bottom: 10px;
                padding: 8px 10px;
                border-radius: 10px;
                background: rgba(248, 113, 113, 0.08);
                border: 1px solid rgba(248, 113, 113, 0.4);
                font-size: 12px;
                color: #b91c1c;
            }

            @media (max-width: 900px) {
                .fl-feedback-layout {
                    grid-template-columns: minmax(0, 1fr);
                }
            }

            @media (max-width: 640px) {
                .fl-feedback-page {
                    padding: 0 10px 28px;
                }

                .fl-feedback-title {
                    font-size: 20px;
                }
            }

            /* ===== LỊCH SỬ FEEDBACK (DƯỚI TRANG) ===== */
            .fl-history-card {
                margin-top: 24px;
                background: var(--fl-card-bg);
                border-radius: 18px;
                border: 1px solid rgba(148, 163, 184, 0.18);
                box-shadow:
                    0 18px 35px rgba(15, 23, 42, 0.08),
                    0 0 0 1px rgba(148, 163, 184, 0.1);
                padding: 16px 20px 18px;
            }

            .fl-history-empty {
                font-size: 12px;
                color: var(--fl-text-muted);
                padding: 10px 4px 2px;
            }

            .fl-history-list {
                margin: 4px 0 0;
                padding: 0;
                list-style: none;
            }

            .fl-history-item {
                padding: 10px 0 12px;
                border-top: 1px dashed rgba(209, 213, 219, 0.9);
            }

            .fl-history-item:first-child {
                border-top: none;
            }

            .fl-history-header {
                display: flex;
                justify-content: space-between;
                gap: 8px;
                align-items: baseline;
            }

            .fl-history-title {
                font-size: 13px;
                font-weight: 600;
                color: var(--fl-primary-soft);
            }

            .fl-history-meta {
                font-size: 11px;
                color: var(--fl-text-muted);
            }

            .fl-history-status {
                display: inline-flex;
                align-items: center;
                padding: 2px 8px;
                border-radius: 999px;
                font-size: 10px;
                font-weight: 600;
            }

            .fl-history-status-NEW {
                background: rgba(251, 191, 36, 0.1);
                color: #92400e;
            }

            .fl-history-status-IN_PROGRESS {
                background: rgba(59, 130, 246, 0.08);
                color: #1d4ed8;
            }

            .fl-history-status-RESOLVED {
                background: rgba(16, 185, 129, 0.1);
                color: #047857;
            }

            .fl-history-desc {
                margin-top: 4px;
                font-size: 12px;
                color: var(--fl-text-main);
            }

            .fl-history-admin-note {
                margin-top: 6px;
                font-size: 11px;
                color: var(--fl-text-muted);
            }

            .fl-history-admin-note strong {
                color: var(--fl-primary-soft);
            }
        </style>
    </h:head>

    <h:body>
           <div id="top"></div>
            <ui:include src="/layout/header.xhtml" />

        <div class="fl-feedback-body">



            <h:form id="feedbackForm">

                <div class="fl-feedback-page">

                    <!-- HEADER -->
                    <header class="fl-feedback-header">

                        <h1 class="fl-feedback-title">
                          SYSTEM FEEDBACK TO ADMIN FEASTLINK
                        </h1>
                        <p class="fl-feedback-subtitle">
                           Admin FeastLink receives feedback, system errors, and complaints.

                        </p>
                    </header>

                    <!-- Nhắc login nếu chưa đăng nhập -->
                    <h:panelGroup rendered="#{customerFeedbackBean.currentUser == null}">
                        <div class="fl-login-hint">
                          You are not logged in. Please log in to your FeastLink account to submit feedback and view the processing status.
                        </div>
                    </h:panelGroup>

                    <!-- MAIN CONTENT: 2 COLUMNS -->
                    <div class="fl-feedback-layout">

                        <!-- LEFT: FORM SEND TO ADMIN -->
                        <section class="fl-feedback-left">

                            <h2 class="fl-section-title">
                                <span class="fl-dot"></span>
                              Feedback information sent to Admin
                            </h2>
                            <p class="fl-section-desc">
                              Please describe the context, the screen you are using, and how the issue affects the catering experience or restaurant operations.
                            </p>

                            <!-- ACCOUNT -->
                            <div class="fl-field">
                                <label class="fl-label">Feedback submission account</label>
                                <h:inputText value="#{customerFeedbackBean.displayAccountName}"
                                             styleClass="fl-input"
                                             readonly="true" />
                                <small class="fl-help-text">
                                  Automatically retrieved from the currently logged-in account.
                                </small>
                            </div>

                            <!-- EMAIL -->
                            <div class="fl-field">
                                <label class="fl-label">Contact email *</label>
                                <h:inputText value="#{customerFeedbackBean.contactEmail}"
                                             styleClass="fl-input" />
                                <small class="fl-help-text">
                                    The FeastLink admin will use this email to communicate with you further if needed.
                                </small>
                            </div>

                            <!-- RESTAURANT + BOOKING (2 CỘT) -->
                            <div class="fl-grid-2">
                                <div class="fl-field">
                                    <label class="fl-label">Restaurant/Related Location</label>
                                    <h:selectOneMenu value="#{customerFeedbackBean.selectedRestaurantId}"
                                                     styleClass="fl-select">
                                        <f:selectItem itemLabel="Choose restaurant..." itemValue="#{null}" />
                                        <f:selectItems value="#{customerFeedbackBean.restaurants}"
                                                       var="r"
                                                       itemLabel="#{r.name}"
                                                       itemValue="#{r.restaurantId}" />

                                        <!-- ✅ CHỈ THÊM AJAX ĐỒNG BỘ -->
                                        <f:ajax event="change"
                                                listener="#{customerFeedbackBean.onRestaurantChange}"
                                                render="bookingWrap" />
                                    </h:selectOneMenu>
                                    <small class="fl-help-text">
                                        Select if the feedback relates to a specific venue.
                                    </small>
                                </div>

                                <!-- ✅ CHỈ THAY BOOKING: CHỈ HIỆN KHI NHÀ HÀNG CÓ BOOKING -->
                                <h:panelGroup id="bookingWrap" layout="block">
                                    <h:panelGroup rendered="#{not empty customerFeedbackBean.bookingsForSelectedRestaurant}">
                                        <div class="fl-field">
                                            <label class="fl-label">Related bookings (if any)</label>
                                            <h:selectOneMenu value="#{customerFeedbackBean.selectedBookingId}"
                                                             styleClass="fl-select">
                                                <f:selectItem itemLabel="Choose code booking..." itemValue="#{null}" />
                                                <f:selectItems value="#{customerFeedbackBean.bookingsForSelectedRestaurant}"
                                                               var="b"
                                                               itemLabel="#{b.bookingCode}"
                                                               itemValue="#{b.bookingId}" />
                                            </h:selectOneMenu>
                                            <small class="fl-help-text">
                                                Only load bookings that belong to your account.
                                            </small>
                                        </div>
                                    </h:panelGroup>
                                </h:panelGroup>
                            </div>

                            <!-- TITLE -->
                            <div class="fl-field">
                                <label class="fl-label">Feedback title *</label>
                                <h:inputText value="#{customerFeedbackBean.title}"
                                             styleClass="fl-input">
                                    <f:validateLength maximum="200" />
                                </h:inputText>
                            </div>

                            <!-- DESCRIPTION -->
                            <div class="fl-field">
                                <label class="fl-label">Detailed content *</label>
                                <h:inputTextarea value="#{customerFeedbackBean.description}"
                                                 styleClass="fl-textarea"
                                                 rows="6">
                                    <f:validateLength maximum="2000" />
                                </h:inputTextarea>
                                <small class="fl-help-text">
                                    Please describe: which screen you are currently on (Homepage, Restaurant Detail, Booking, Manager Dashboard, Payment...),

                                    what action you are performing, how the system responds (error, slowness, incorrect display...), the time, and its impact on you/the customer/the restaurant.
                                </small>
                            </div>

                            <!-- ACTION BUTTONS -->
                            <div class="fl-actions">
                                <h:commandButton value="Cancel"
                                                 type="reset"
                                                 styleClass="fl-btn fl-btn-ghost" />

                                <h:commandButton value="Send feedback For Admin FeastLink"
                                                 action="#{customerFeedbackBean.submitFeedback}"
                                                 styleClass="fl-btn fl-btn-primary"
                                                 disabled="#{customerFeedbackBean.currentUser == null}" />
                            </div>

                            <!-- THÔNG BÁO FACES MESSAGE -->
                            <h:messages styleClass="fl-messages"
                                        errorClass="fl-message-error"
                                        infoClass="fl-message-info"
                                        warnClass="fl-message-warn" />

                        </section>

                        <!-- RIGHT: ADMIN STATUS PANEL (READ ONLY) -->
                        <aside class="fl-feedback-right">

                            <h2 class="fl-section-title">
                                <span class="fl-dot"></span>
                                Processing status from Admin
                            </h2>
                            <p class="fl-section-desc">
                              These fields are used by the Admin system to track the feedback lifecycle and communicate back to you.
                            </p>

                            <!-- STATUS BADGE -->
                            <div class="fl-status-header">
                                <div class="fl-status-label">Status:</div>
                                <div class="fl-status-pill">
                                    <span class="fl-status-dot"></span>
                                    <span class="fl-status-text">
                                        #{customerFeedbackBean.displayStatus}
                                    </span>
                                </div>
                            </div>

                            <!-- FIELDS (READ-ONLY) -->
                            <div class="fl-grid-2">
                                <div class="fl-field">
                                    <label class="fl-label">ID feedback</label>
                                    <h:inputText value="#{customerFeedbackBean.lastFeedbackId}"
                                                 styleClass="fl-input fl-input-readonly"
                                                 readonly="true" />
                                </div>
                                <div class="fl-field">
                                    <label class="fl-label">Admin in charge</label>
                                    <h:inputText value="#{customerFeedbackBean.lastAdminName}"
                                                 styleClass="fl-input fl-input-readonly"
                                                 readonly="true" />
                                </div>
                            </div>

                            <div class="fl-grid-2">
                                <div class="fl-field">
                                    <label class="fl-label">Creation date</label>
                                    <h:inputText value="#{customerFeedbackBean.lastCreatedAt}"
                                                 styleClass="fl-input fl-input-readonly"
                                                 readonly="true">
                                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm"
                                                           timeZone="Asia/Ho_Chi_Minh" />
                                    </h:inputText>
                                </div>

                                <div class="fl-field">
                                    <label class="fl-label">Last updated</label>
                                    <h:inputText value="#{customerFeedbackBean.lastUpdatedAt}"
                                                 styleClass="fl-input fl-input-readonly"
                                                 readonly="true">
                                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm"
                                                           timeZone="Asia/Ho_Chi_Minh" />
                                    </h:inputText>
                                </div>
                            </div>

                            <div class="fl-field">
                                <label class="fl-label">Feedback closing date</label>
                                <h:inputText value="#{customerFeedbackBean.lastResolvedAt}"
                                             styleClass="fl-input fl-input-readonly"
                                             readonly="true">
                                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm"
                                                       timeZone="Asia/Ho_Chi_Minh" />
                                </h:inputText>
                            </div>

                            <div class="fl-field">
                                <label class="fl-label">Admin's processing notes</label>
                                <h:inputTextarea value="#{customerFeedbackBean.lastResolutionNote}"
                                                 styleClass="fl-textarea fl-textarea-readonly"
                                                 rows="5"
                                                 readonly="true" />
                            </div>

                            <!-- TIPS -->
                            <div class="fl-tips">
                                <h3 class="fl-tips-title">Tips for sending effective system feedback</h3>
                                <ul class="fl-tips-list">
                                    <li>Please specify the time, device (PC/Mobile), and browser if it's a display error.</li>
                                    <li>If it relates to a booking, please include the booking code and the restaurant name.</li>
                                    <li>If you are a Manager: clearly describe which module on the Dashboard you are referring to (Menu, Booking, Pricing, etc.).</li>
                                    <li>If you are a Customer: describe each step of the interaction on the screen (Search, View details, Payment...).</li>
                                </ul>
                            </div>

                        </aside>

                    </div> <!-- /fl-feedback-layout -->

                    <!-- LỊCH SỬ FEEDBACK CỦA BẠN -->
                    <section class="fl-history-card">
                        <h2 class="fl-section-title">
                            <span class="fl-dot"></span>
                          Your feedback history
                        </h2>
                        <p class="fl-section-desc">
                       Recent feedback you have sent to the FeastLink Admin and the corresponding responses from the Admin.
                        </p>

                        <!-- Nếu chưa có feedback nào -->
                        <h:panelGroup rendered="#{empty customerFeedbackBean.myFeedbackHistory}">
                            <div class="fl-history-empty">
                              You haven't left any feedback yet. Please submit your first feedback so that the FeastLink Admin can assist you.
                            </div>
                        </h:panelGroup>

                        <!-- Danh sách feedback -->
                        <h:panelGroup rendered="#{not empty customerFeedbackBean.myFeedbackHistory}">
                            <ul class="fl-history-list">
                                <ui:repeat value="#{customerFeedbackBean.myFeedbackHistory}" var="fb">
                                    <li class="fl-history-item">
                                        <div class="fl-history-header">
                                            <div>
                                                <div class="fl-history-title">
                                                    ID # #{fb.feedbackId} · #{fb.title}
                                                </div>
                                                <div class="fl-history-meta">
                                                    <h:outputText value="#{fb.createdAt}">
                                                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm"
                                                                           timeZone="Asia/Ho_Chi_Minh" />
                                                    </h:outputText>
                                                    <h:panelGroup rendered="#{fb.restaurantId != null}">
                                                        · #{fb.restaurantId.name}
                                                    </h:panelGroup>
                                                    <h:panelGroup rendered="#{fb.bookingId != null}">
                                                        · Booking: #{fb.bookingId.bookingCode}
                                                    </h:panelGroup>
                                                </div>
                                            </div>

                                            <span class="fl-history-status fl-history-status-#{fb.status}">
                                                #{fb.status}
                                            </span>
                                        </div>

                                        <div class="fl-history-desc">
                                            #{fb.description}
                                        </div>

                                        <div class="fl-history-admin-note">
                                            <h:panelGroup rendered="#{fb.resolutionNote != null}">
                                                <strong>Phản hồi từ Admin:</strong>
                                                #{fb.resolutionNote}
                                                <h:panelGroup rendered="#{fb.resolvedAt != null}">
                                                    ·
                                                    <h:outputText value="#{fb.resolvedAt}">
                                                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm"
                                                                           timeZone="Asia/Ho_Chi_Minh" />
                                                    </h:outputText>
                                                </h:panelGroup>
                                            </h:panelGroup>

                                            <h:panelGroup rendered="#{fb.resolutionNote == null}">
                                                <strong>Response from Admin:</strong>
                                               Waiting for Admin to process...
                                            </h:panelGroup>
                                        </div>
                                    </li>
                                </ui:repeat>
                            </ul>
                        </h:panelGroup>
                    </section>

                </div> <!-- /fl-feedback-page -->

            </h:form>

        </div> <!-- /fl-feedback-body -->
          <ui:include src="/layout/footer.xhtml" />

    </h:body>
</html>
