<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets"
      xmlns:pass="jakarta.faces.passthrough">

    <h:head>
        <meta charset="UTF-8" />
        <title>FeastLink - My Bookings</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <!-- Tailwind CDN -->
        <script src="https://cdn.tailwindcss.com"></script>
        <!-- Lucide Icons CDN -->
        <script src="https://unpkg.com/lucide@latest"></script>

        <style type="text/css">
            body {
                margin: 0;
                font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
                background-color: #F9FAFB;
            }
        </style>
    </h:head>

    <h:body class="bg-[#F9FAFB]">
        <!-- HEADER / FOOTER đã có sẵn -->
        <ui:include src="/layout/header.xhtml" />

        <!-- =================== PAGE BODY =================== -->
        <main class="pt-28 pb-16 min-h-screen bg-[#F9FAFB]">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

                <!-- =========== Page Intro + Stats =========== -->
                <section id="page-intro" class="mb-8">
                    <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6 lg:gap-8">
                        <div class="flex-1">
                            <div class="inline-block">
                                <h1 class="text-4xl sm:text-5xl font-bold text-[#0B1120] mb-2">
                                    My Bookings
                                </h1>
                                <div class="h-1 w-24 bg-gradient-to-r from-[#D4AF37] to-[#E6C77F] rounded-full"></div>
                            </div>
                            <p class="text-[#4B5563] text-lg mt-4 max-w-2xl leading-relaxed">
                                Track all your banquet reservations – status, payments, and event details in one place.
                            </p>
                        </div>

                        <h:panelGroup layout="block"
                                      styleClass="grid grid-cols-1 sm:grid-cols-3 gap-4 lg:min-w-[400px]">
                            <!-- Upcoming Events -->
                            <div
                                class="bg-white border border-[#E6C77F]/30 rounded-2xl p-5 hover:shadow-lg hover:border-[#D4AF37]/50 transition-all duration-300">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="text-[#D4AF37]">
                                        <i data-lucide="calendar" class="w-5 h-5"></i>
                                    </div>
                                    <span class="text-[#4B5563] text-sm font-medium">Upcoming Events</span>
                                </div>
                                <p id="stat-upcoming" class="text-2xl font-bold text-[#0B1120] ml-8">
                                    <h:outputText value="#{customerMyBookingsBean.upcomingCount}" />
                                </p>
                            </div>

                            <!-- Completed -->
                            <div
                                class="bg-white border border-[#E6C77F]/30 rounded-2xl p-5 hover:shadow-lg hover:border-[#D4AF37]/50 transition-all duration-300">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="text-[#22C55E]">
                                        <i data-lucide="check-circle-2" class="w-5 h-5"></i>
                                    </div>
                                    <span class="text-[#4B5563] text-sm font-medium">Completed</span>
                                </div>
                                <p id="stat-completed" class="text-2xl font-bold text-[#0B1120] ml-8">
                                    <h:outputText value="#{customerMyBookingsBean.completedCount}" />
                                </p>
                            </div>

                            <!-- Total Spent -->
                            <div
                                class="bg-white border border-[#E6C77F]/30 rounded-2xl p-5 hover:shadow-lg hover:border-[#D4AF37]/50 transition-all duration-300">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="text-[#E6C77F]">
                                        <i data-lucide="dollar-sign" class="w-5 h-5"></i>
                                    </div>
                                    <span class="text-[#4B5563] text-sm font-medium">Total Spent</span>
                                </div>
                                <p id="stat-total-spent" class="text-2xl font-bold text-[#0B1120] ml-8">
                                    <h:outputText value="#{customerMyBookingsBean.formattedTotalSpent}" />
                                </p>
                            </div>
                        </h:panelGroup>
                    </div>
                </section>

                <!-- =========== Filter Toolbar =========== -->
                <section class="mt-8 bg-white/80 backdrop-blur-xl border border-[#E5E7EB] rounded-3xl p-4 sm:p-6 shadow-lg">
                    <div class="flex flex-col xl:flex-row xl:items-center xl:justify-between gap-4">
                        <!-- Tabs -->
                        <div class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide sm:flex-wrap sm:overflow-visible sm:pb-0">
                            <button type="button"
                                    data-role="status-tab"
                                    data-filter-value="all"
                                    class="px-6 py-2.5 rounded-full font-medium whitespace-nowrap transition-all duration-300">
                                All
                            </button>

                            <button type="button"
                                    data-role="status-tab"
                                    data-filter-value="upcoming"
                                    class="px-6 py-2.5 rounded-full font-medium whitespace-nowrap transition-all duration-300">
                                Upcoming
                            </button>

                            <button type="button"
                                    data-role="status-tab"
                                    data-filter-value="confirmed"
                                    class="px-6 py-2.5 rounded-full font-medium whitespace-nowrap transition-all duration-300">
                                Confirmed
                            </button>

                            <button type="button"
                                    data-role="status-tab"
                                    data-filter-value="completed"
                                    class="px-6 py-2.5 rounded-full font-medium whitespace-nowrap transition-all duration-300">
                                Completed
                            </button>

                            <button type="button"
                                    data-role="status-tab"
                                    data-filter-value="cancelled"
                                    class="px-6 py-2.5 rounded-full font-medium whitespace-nowrap transition-all duration-300">
                                Cancelled
                            </button>

                        </div>

                        <!-- Search -->
                        <!-- Search + Sort -->
                        <div class="flex gap-3 w-full lg:w-auto">
                            <!-- Search -->
                            <div class="relative flex-1 lg:flex-none lg:w-80">
                                <i data-lucide="search"
                                   class="absolute left-4 top-1/2 -translate-y-1/2 text-[#4B5563] w-5 h-5 pointer-events-none"></i>
                                <input id="search-input"
                                       type="text"
                                       placeholder="Search by venue or booking code…"
                                       class="w-full pl-12 pr-4 py-3 bg-[#F9FAFB] border border-[#E5E7EB] rounded-full text-sm text-[#111827] placeholder:text-[#9CA3AF] focus:outline-none focus:ring-2 focus:ring-[#D4AF37]/30 focus:border-[#D4AF37] transition-all" />
                            </div>

                            <!-- Sort -->
                            <div class="flex items-center gap-2">
                                <span class="hidden sm:inline text-xs text-[#6B7280] uppercase tracking-wide">
                                    Sort
                                </span>
                                <select id="sort-select"
                                        class="px-3 py-2 rounded-full border border-[#E5E7EB] bg-[#F9FAFB] text-sm text-[#111827] focus:outline-none focus:ring-2 focus:ring-[#D4AF37]/40 focus:border-[#D4AF37]">
                                    <option value="newest" selected="selected">Newest first</option>
                                    <option value="oldest">Oldest first</option>
                                </select>
                            </div>

                            <!-- Venue -->
                            <div class="flex items-center gap-2">
                                <span class="hidden sm:inline text-xs text-[#6B7280] uppercase tracking-wide">
                                    Venue
                                </span>
                                <select id="restaurant-select"
                                        class="px-3 py-2 rounded-full border border-[#E5E7EB] bg-[#F9FAFB] text-sm text-[#111827]
                                        focus:outline-none focus:ring-2 focus:ring-[#D4AF37]/40 focus:border-[#D4AF37]">
                                    <option value="all" selected="selected">All venues</option>
                                    <ui:repeat value="#{customerMyBookingsBean.bookedRestaurants}" var="r">
                                        <option value="#{r.restaurantId}">#{r.name}</option>
                                    </ui:repeat>
                                </select>
                            </div>
                            <!-- Clear Filters -->
                            <div class="flex items-center">
                                <button type="button"
                                        id="clear-filters-btn"
                                        class="px-4 py-2 rounded-full border border-[#E5E7EB] bg-white text-sm font-medium text-[#111827]
                                        hover:border-[#E6C77F] hover:text-[#D4AF37] transition-all flex items-center gap-2">
                                    <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                                    Clear
                                </button>
                            </div>


                        </div>

                    </div>
                </section>

                <!-- =========== Empty state: KHÔNG có booking nào =========== -->
                <h:panelGroup rendered="#{empty customerMyBookingsBean.myBookings}">
                    <div class="mt-12">
                        <div class="bg-gradient-to-br from-white to-[#F9FAFB] rounded-3xl border border-[#E5E7EB] p-12 text-center shadow-xl">
                            <div class="max-w-md mx-auto">
                                <div class="w-24 h-24 bg-gradient-to-br from-[#0B1120] to-[#020617] rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg">
                                    <i data-lucide="calendar-x-2" class="w-12 h-12 text-[#D4AF37]"></i>
                                </div>
                                <h3 class="text-3xl font-bold text-[#0B1120] mb-4">You don't have any bookings yet</h3>
                                <p class="text-[#4B5563] text-lg leading-relaxed mb-8">
                                    Once you book a venue, your reservations will appear here. Start planning your perfect event today.
                                </p>
                                <h:link outcome="/Customer/restaurants" styleClass="inline-block">
                                    <span
                                        class="px-8 py-4 bg-gradient-to-r from-[#0B1120] to-[#020617] hover:from-[#020617] hover:to-[#0B1120] text-white font-semibold rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl border border-[#D4AF37] hover:border-[#E6C77F]">
                                        Explore Restaurants
                                    </span>
                                </h:link>
                            </div>
                        </div>
                    </div>
                </h:panelGroup>

                <!-- =========== Có booking: list + empty-filter state =========== -->
                <h:panelGroup rendered="#{not empty customerMyBookingsBean.myBookings}" layout="block">

                    <!-- Empty state khi filter không match cái nào (JS control) -->
                    <div id="empty-filter-state" class="mt-12 hidden">
                        <div class="bg-white rounded-3xl border-2 border-dashed border-[#E5E7EB] p-12 text-center">
                            <div class="max-w-md mx-auto">
                                <div class="w-20 h-20 bg-gradient-to-br from-[#E6C77F]/20 to-[#D4AF37]/20 rounded-full flex items-center justify-center mx-auto mb-6">
                                    <i data-lucide="search" class="w-10 h-10 text-[#D4AF37]"></i>
                                </div>
                                <h3 class="text-2xl font-bold text-[#0B1120] mb-3">No bookings match your filters</h3>
                                <p class="text-[#4B5563] leading-relaxed">
                                    Try adjusting your search or filter criteria to find what you're looking for.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Bọc danh sách bằng FORM để commandLink hoạt động -->
                    <h:form id="myBookingsForm">
                        <h:messages id="msgs" globalOnly="true" layout="list"
                                    styleClass="mt-4 space-y-2 text-sm"
                                    errorClass="rounded-2xl border border-red-200 bg-red-50 px-4 py-3 text-red-700"
                                    infoClass="rounded-2xl border border-emerald-200 bg-emerald-50 px-4 py-3 text-emerald-800"
                                    warnClass="rounded-2xl border border-amber-200 bg-amber-50 px-4 py-3 text-amber-800"/>

                        <!-- DANH SÁCH BOOKING -->
                        <div id="bookings-list" class="grid grid-cols-1 gap-6 mt-8">
                            <ui:repeat value="#{customerMyBookingsBean.pagedBookings}" var="b">
                                <div
                                    class="booking-card group bg-white rounded-3xl border border-[#E5E7EB] shadow-lg hover:shadow-2xl hover:border-[#D4AF37]/50 transition-all duration-500 overflow-hidden hover:-translate-y-1"
                                    data-role="booking-card"
                                    data-booking-status="#{b.bookingStatus}"
                                    data-payment-status="#{b.paymentStatus}"
                                    data-booking-code="#{b.bookingCode}"
                                    data-restaurant-name="#{b.restaurantId.name}"
                                    data-restaurant-id="#{b.restaurantId.restaurantId}"
                                    data-created-at="#{customerMyBookingsBean.bookingCreatedAtMillis(b)}">


                                    <div class="p-6 sm:p-8">
                                        <!-- Top row -->
                                        <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4 mb-6">
                                            <div class="flex-1">
                                                <div class="flex flex-wrap items-center gap-3 mb-3">
                                                    <span class="px-4 py-1.5 bg-gradient-to-r from-[#E6C77F]/20 to-[#D4AF37]/20 text-[#0B1120] text-sm font-semibold rounded-full border border-[#D4AF37]/30">
                                                        <h:outputText value="#{b.bookingCode}" />
                                                    </span>
                                                </div>
                                                <h3 class="text-2xl font-bold text-[#0B1120] mb-2 group-hover:text-[#D4AF37] transition-colors">
                                                    <h:outputText value="#{b.restaurantId.name}" />
                                                </h3>
                                                <div class="flex flex-wrap items-center gap-2 text-[#4B5563]">
                                                    <span class="font-medium">
                                                        <h:outputText value="#{customerMyBookingsBean.eventTypeDisplay(b)}" />
                                                    </span>
                                                    <span class="w-1 h-1 rounded-full bg-[#D4AF37]"></span>
                                                    <span>
                                                        <h:outputText value="#{b.guestCount}" /> guests
                                                    </span>
                                                    <span class="w-1 h-1 rounded-full bg-[#D4AF37]"></span>
                                                    <span>
                                                        <h:outputText value="#{customerMyBookingsBean.locationDisplay(b)}" />
                                                    </span>
                                                </div>
                                                <div class="mt-2 space-y-1 text-sm text-[#6B7280]">
                                                    <!-- Package -->
                                                    <h:panelGroup rendered="#{customerMyBookingsBean.hasPackage(b)}">
                                                        <p>
                                                            <span class="font-medium text-[#0B1120]">Package:</span>
                                                            <span>
                                                                <h:outputText value="#{customerMyBookingsBean.packageName(b)}" />
                                                            </span>
                                                        </p>
                                                    </h:panelGroup>

                                                    <!-- Custom menu -->
                                                    <h:panelGroup rendered="#{customerMyBookingsBean.hasMenuItems(b)}">
                                                        <p>
                                                            <span class="font-medium text-[#0B1120]">Custom menu:</span>
                                                            <span>
                                                                <h:outputText value="#{customerMyBookingsBean.menuSummary(b)}" />
                                                            </span>
                                                        </p>
                                                    </h:panelGroup>
                                                </div>

                                            </div>

                                            <!-- Status & Payment badges -->
                                            <div class="flex flex-wrap gap-2 sm:flex-col sm:items-end">
                                                <!-- Booking status -->
                                                <h:panelGroup rendered="#{b.bookingStatus eq 'PENDING'}">
                                                    <span class="px-4 py-1.5 rounded-full text-sm font-semibold border-2 bg-[#EAB308]/10 text-[#EAB308] border-[#EAB308]">
                                                        Pending
                                                    </span>
                                                </h:panelGroup>
                                                <h:panelGroup rendered="#{b.bookingStatus eq 'CONFIRMED'}">
                                                    <span class="px-4 py-1.5 rounded-full text-sm font-semibold border-2 bg-[#22C55E] text-white border-[#22C55E]">
                                                        Confirmed
                                                    </span>
                                                </h:panelGroup>
                                                <h:panelGroup rendered="#{b.bookingStatus eq 'COMPLETED'}">
                                                    <span class="px-4 py-1.5 rounded-full text-sm font-semibold border-2 bg-[#0B1120] text-[#D4AF37] border-[#0B1120]">
                                                        Completed
                                                    </span>
                                                </h:panelGroup>
                                                <h:panelGroup rendered="#{b.bookingStatus eq 'CANCELLED'}">
                                                    <span class="px-4 py-1.5 rounded-full text-sm font-semibold border-2 bg-[#EF4444] text-white border-[#EF4444]">
                                                        Cancelled
                                                    </span>
                                                </h:panelGroup>

                                                <!-- Payment status -->
                                                <h:panelGroup rendered="#{b.paymentStatus eq 'UNPAID'}">
                                                    <span class="px-4 py-1.5 rounded-full text-sm font-semibold border bg-[#4B5563]/10 text-[#4B5563] border-[#4B5563]/30">
                                                        Unpaid
                                                    </span>
                                                </h:panelGroup>
                                                <h:panelGroup rendered="#{b.paymentStatus eq 'DEPOSIT_PAID'}">
                                                    <span class="px-4 py-1.5 rounded-full text-sm font-semibold border bg-[#EAB308]/10 text-[#EAB308] border-[#EAB308]/50">
                                                        Deposit Paid
                                                    </span>
                                                </h:panelGroup>
                                                <h:panelGroup rendered="#{b.paymentStatus eq 'PAID'}">
                                                    <span class="px-4 py-1.5 rounded-full text-sm font-semibold border bg-[#22C55E]/10 text-[#22C55E] border-[#22C55E]/50">
                                                        Paid in Full
                                                    </span>
                                                </h:panelGroup>
                                            </div>
                                        </div>

                                        <!-- Middle: event + payment summary -->
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                            <div class="space-y-4">
                                                <h4 class="text-sm font-semibold text-[#0B1120] uppercase tracking-wide mb-3">
                                                    Event Details
                                                </h4>

                                                <div class="flex items-start gap-3">
                                                    <i data-lucide="calendar" class="w-5 h-5 text-[#D4AF37] mt-0.5 flex-shrink-0"></i>
                                                    <div>
                                                        <p class="text-[#111827] font-medium">
                                                            <h:outputText value="#{customerMyBookingsBean.formatDateShort(b.eventDate)}" />
                                                        </p>
                                                    </div>
                                                </div>

                                                <div class="flex items-start gap-3">
                                                    <i data-lucide="clock" class="w-5 h-5 text-[#D4AF37] mt-0.5 flex-shrink-0"></i>
                                                    <div>
                                                        <p class="text-[#111827] font-medium">
                                                            <h:outputText value="#{customerMyBookingsBean.formatTime(b.startTime)}" /> –
                                                            <h:outputText value="#{customerMyBookingsBean.formatTime(b.endTime)}" />
                                                        </p>
                                                    </div>
                                                </div>

                                                <div class="flex items-start gap-3">
                                                    <i data-lucide="map-pin" class="w-5 h-5 text-[#D4AF37] mt-0.5 flex-shrink-0"></i>
                                                    <div>
                                                        <p class="text-[#111827] font-medium">
                                                            <h:outputText value="#{customerMyBookingsBean.locationDisplay(b)}" />
                                                        </p>
                                                    </div>
                                                </div>

                                                <div class="flex items-start gap-3">
                                                    <i data-lucide="users" class="w-5 h-5 text-[#D4AF37] mt-0.5 flex-shrink-0"></i>
                                                    <div>
                                                        <p class="text-[#111827] font-medium">
                                                            <h:outputText value="Booked by " />
                                                            <h:outputText value="#{customerMyBookingsBean.bookerDisplay(b)}" />
                                                        </p>

                                                    </div>
                                                </div>
                                            </div>

                                            <div class="bg-gradient-to-br from-[#F9FAFB] to-white border border-[#E5E7EB] rounded-2xl p-5">
                                                <h4 class="text-sm font-semibold text-[#0B1120] uppercase tracking-wide mb-4">
                                                    Payment Summary
                                                </h4>

                                                <div class="space-y-3">

                                                    <!-- Package subtotal -->
                                                    <h:panelGroup rendered="#{customerMyBookingsBean.hasPackage(b)}">
                                                        <div class="flex justify-between items-center">
                                                            <span class="text-[#4B5563] text-sm">Package subtotal</span>
                                                            <span class="font-medium">
                                                                <h:outputText
                                                                    value="#{customerMyBookingsBean.formatMoney(customerMyBookingsBean.packageSubtotal(b))}" />
                                                            </span>
                                                        </div>
                                                    </h:panelGroup>

                                                    <!-- Custom menu subtotal -->
                                                    <h:panelGroup rendered="#{customerMyBookingsBean.hasMenuItems(b)}">
                                                        <div class="flex justify-between items-center">
                                                            <span class="text-[#4B5563] text-sm">Custom menu subtotal</span>
                                                            <span class="font-medium">
                                                                <h:outputText
                                                                    value="#{customerMyBookingsBean.formatMoney(customerMyBookingsBean.menuSubtotal(b))}" />
                                                            </span>
                                                        </div>
                                                    </h:panelGroup>

                                                    <!-- Other charges -->
                                                    <h:panelGroup rendered="#{customerMyBookingsBean.otherCharges(b) gt 0}">
                                                        <div class="flex justify-between items-center pb-3 border-b border-[#E5E7EB]">
                                                            <span class="text-[#4B5563] text-sm">Other charges</span>
                                                            <span class="font-medium">
                                                                <h:outputText
                                                                    value="#{customerMyBookingsBean.formatMoney(customerMyBookingsBean.otherCharges(b))}" />
                                                            </span>
                                                        </div>
                                                    </h:panelGroup>

                                                    <!-- Deposit -->
                                                    <div class="flex justify-between items-center">
                                                        <span class="text-[#4B5563] text-sm">Deposit paid</span>
                                                        <span class="text-[#22C55E] font-semibold">
                                                            <h:outputText value="#{customerMyBookingsBean.formatMoney(b.depositAmount)}" />
                                                        </span>
                                                    </div>

                                                    <!-- Remaining -->
                                                    <div class="flex justify-between items-center">
                                                        <span class="text-[#4B5563] text-sm">Remaining</span>
                                                        <h:panelGroup rendered="#{customerMyBookingsBean.isRemainingPositive(b)}">
                                                            <span class="font-semibold text-[#F97316]">
                                                                <h:outputText value="#{customerMyBookingsBean.formatMoney(b.remainingAmount)}" />
                                                            </span>
                                                        </h:panelGroup>
                                                        <h:panelGroup rendered="#{not customerMyBookingsBean.isRemainingPositive(b)}">
                                                            <span class="font-semibold text-[#22C55E]">
                                                                <h:outputText value="#{customerMyBookingsBean.formatMoney(b.remainingAmount)}" />
                                                            </span>
                                                        </h:panelGroup>
                                                    </div>

                                                    <!-- Total amount ở cuối -->
                                                    <div class="flex justify-between items-center pt-3 border-t border-[#E5E7EB]">
                                                        <span class="text-[#4B5563] text-xs font-semibold uppercase tracking-wide">
                                                            Total amount
                                                        </span>
                                                        <span class="text-lg font-bold text-[#0B1120]">
                                                            <h:outputText value="#{customerMyBookingsBean.formatMoney(b.totalAmount)}" />
                                                        </span>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>

                                        <!-- Bottom row: message + actions -->
                                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 pt-6 border-t border-[#E5E7EB]">
                                            <p class="text-sm text-[#4B5563] flex-1 leading-relaxed">
                                                <h:outputText value="#{customerMyBookingsBean.statusMessage(b)}" />
                                            </p>

                                            <div class="flex flex-wrap gap-3">
                                                <!-- Pay remaining: demo (chưa xử lý backend) -->
                                                <h:panelGroup rendered="#{customerMyBookingsBean.needsPayment(b)}">
                                                    <button type="button"
                                                            class="btn-pay-remaining px-6 py-3 bg-[#F97316] hover:bg-[#EA580C] text-white font-semibold rounded-xl transition-all duration-300 shadow-md hover:shadow-lg flex items-center gap-2">
                                                        <i data-lucide="credit-card" class="w-4 h-4"></i>
                                                        Pay Remaining
                                                    </button>
                                                </h:panelGroup>

                                                <!-- Edit (only PENDING + UNPAID) -->
                                                <h:panelGroup rendered="#{customerMyBookingsBean.canEditBooking(b)}">
                                                    <h:commandLink
                                                        actionListener="#{customerMyBookingsBean.prepareEdit(b.bookingId)}"
                                                        styleClass="px-6 py-3 bg-white hover:bg-[#FFFBEB] text-[#D4AF37] border-2 border-[#D4AF37]
                                                        font-semibold rounded-xl transition-all duration-300 flex items-center gap-2">
                                                        <i data-lucide="pencil" class="w-4 h-4"></i>
                                                        <span>Edit</span>
                                                        <f:ajax execute="@this" render=":myBookingsForm:editModal :myBookingsForm:msgs"
                                                                onevent="feastlinkCustomerEditEvent"/>

                                                    </h:commandLink>
                                                </h:panelGroup>


                                                <!-- Cancel booking: open modal + require reason -->
                                                <h:panelGroup rendered="#{customerMyBookingsBean.canCancel(b)}">
                                                    <h:commandLink
                                                        actionListener="#{customerMyBookingsBean.prepareCancel(b.bookingId)}"
                                                        styleClass="btn-cancel-booking px-6 py-3 bg-white hover:bg-[#FEF2F2] text-[#EF4444] border-2 border-[#EF4444] font-semibold rounded-xl transition-all duration-300 flex items-center gap-2">

                                                        <f:ajax execute="@this"
                                                                render=":myBookingsForm:cancelModal :myBookingsForm:msgs"
                                                                onevent="feastlinkCustomerPrepareCancelEvent"/>

                                                        <i data-lucide="x-circle" class="w-4 h-4"></i>
                                                        <span>Cancel</span>
                                                    </h:commandLink>
                                                </h:panelGroup>

                                                <!-- Delete quotation (only DRAFT + UNPAID) -->
                                                <h:panelGroup rendered="#{customerMyBookingsBean.canDeleteQuotation(b)}">
                                                    <h:commandLink
                                                        actionListener="#{customerMyBookingsBean.prepareDeleteQuotation(b.bookingId)}"
                                                        styleClass="px-6 py-3 bg-white hover:bg-[#FEF2F2] text-[#EF4444] border-2 border-[#EF4444]
                                                        font-semibold rounded-xl transition-all duration-300 flex items-center gap-2">
                                                        <f:ajax execute="@this"
                                                                render=":myBookingsForm:deleteModal :myBookingsForm:msgs"
                                                                onevent="feastlinkCustomerPrepareDeleteEvent"/>
                                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                                        <span>Delete</span>
                                                    </h:commandLink>
                                                </h:panelGroup>

                                                <!-- View details: sang trang booking-details -->
                                                <h:link outcome="/Customer/booking-details"
                                                        styleClass="btn-view-details px-6 py-3 bg-gradient-to-r from-[#F97316] to-[#EAB308] hover:from-[#EA580C] hover:to-[#D4AF37] text-white font-semibold rounded-xl transition-all duration-300 shadow-md hover:shadow-xl flex items-center gap-2">
                                                    <f:param name="id" value="#{b.bookingId}" />
                                                    <span>View Details</span>
                                                    <i data-lucide="chevron-right" class="w-4 h-4"></i>
                                                </h:link>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </ui:repeat>
                        </div>
                        <!-- PAGINATION BAR -->
                        <h:panelGroup rendered="#{customerMyBookingsBean.totalRecords gt 0}">
                            <div class="mt-8 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">

                                <!-- Info bên trái -->
                                <div class="text-sm text-[#4B5563]">
                                    Page
                                    <span class="font-semibold text-[#0B1120]">
                                        <h:outputText value="#{customerMyBookingsBean.currentPage}" />
                                    </span>
                                    of
                                    <span class="font-semibold text-[#0B1120]">
                                        <h:outputText value="#{customerMyBookingsBean.totalPages}" />
                                    </span>
                                    ·
                                    <span class="text-[#6B7280]">
                                        <h:outputText value="#{customerMyBookingsBean.totalRecords}" /> bookings
                                    </span>
                                </div>

                                <!-- Nút phân trang bên phải -->
                                <div class="flex items-center gap-2">

                                    <!-- Previous -->
                                    <h:panelGroup rendered="#{customerMyBookingsBean.currentPage gt 1}">
                                        <h:commandLink action="#{customerMyBookingsBean.previousPage}"
                                                       immediate="true"
                                                       styleClass="px-3 py-1.5 rounded-full border border-[#E5E7EB] text-xs font-medium text-[#4B5563] bg-white hover:border-[#D4AF37] hover:text-[#0B1120] transition-all">
                                            ‹ Prev
                                        </h:commandLink>
                                    </h:panelGroup>

                                    <!-- Số trang -->
                                    <ui:repeat value="#{customerMyBookingsBean.pageNumbers}" var="p">
                                        <h:commandLink action="#{customerMyBookingsBean.changePage}"
                                                       immediate="true"
                                                       styleClass="#{customerMyBookingsBean.currentPage eq p
                                                                     ? 'px-3 py-1.5 rounded-full text-xs font-semibold bg-gradient-to-r from-[#D4AF37] to-[#E6C77F] text-[#111827] shadow-sm'
                                                                     : 'px-3 py-1.5 rounded-full text-xs font-medium border border-[#E5E7EB] text-[#4B5563] bg-white hover:border-[#D4AF37] hover:text-[#111827] transition-all'}">
                                            <f:setPropertyActionListener target="#{customerMyBookingsBean.currentPage}" value="#{p}" />
                                            <span>#{p}</span>
                                        </h:commandLink>
                                    </ui:repeat>

                                    <!-- Next -->
                                    <h:panelGroup rendered="#{customerMyBookingsBean.currentPage lt customerMyBookingsBean.totalPages}">
                                        <h:commandLink action="#{customerMyBookingsBean.nextPage}"  immediate="true"
                                                       styleClass="px-3 py-1.5 rounded-full border border-[#E5E7EB] text-xs font-medium text-[#4B5563] bg-white hover:border-[#D4AF37] hover:text-[#0B1120] transition-all">
                                            Next ›
                                        </h:commandLink>
                                    </h:panelGroup>
                                </div>
                            </div>
                        </h:panelGroup>
                        <!-- EDIT MODAL -->
                        <h:panelGroup id="editModal">
                            <!-- flag để JS biết save edit ok chưa -->
                            <h:inputHidden id="editSaveOk" value="#{customerMyBookingsBean.editSaveSuccess}"/>
                            <h:inputHidden id="editBookingId" value="#{customerMyBookingsBean.editBookingId}"/>

                            <div id="customerEditModal" class="fixed inset-0 z-50 hidden">
                                <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeCustomerEditModal()"></div>

                                <div class="relative mx-auto mt-10 sm:mt-16 w-[92%] max-w-2xl rounded-3xl bg-white shadow-2xl border border-gray-100 overflow-hidden">
                                    <div class="px-6 py-5 border-b border-gray-100 flex items-center justify-between">
                                        <div>
                                            <p class="text-[11px] uppercase tracking-widest text-gray-500">Edit booking</p>
                                            <p class="text-lg font-semibold text-[#0B1120]">Update your event details</p>
                                        </div>
                                        <button type="button"
                                                class="w-10 h-10 rounded-2xl flex items-center justify-center bg-gray-50 hover:bg-gray-100 text-gray-700"
                                                onclick="closeCustomerEditModal()">✕</button>
                                    </div>

                                    <div class="px-6 py-6 space-y-5">

                                        <!-- Event date -->
                                        <div>
                                            <label class="block text-xs font-medium text-gray-600 mb-2">Event date</label>
                                            <h:inputText id="editEventDate"
                                                         value="#{customerMyBookingsBean.editEventDate}"
                                                         pass:type="date"
                                                         pass:min="#{customerMyBookingsBean.editMinDate}"
                                                         styleClass="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-2.5 text-sm text-gray-800
                                                         focus:outline-none focus:ring-2 focus:ring-[#D4AF37]/40">
                                                <f:convertDateTime pattern="yyyy-MM-dd"/>
                                            </h:inputText>
                                            <h:message for="editEventDate" styleClass="block mt-2 text-xs text-red-600"/>
                                        </div>

                                        <!-- Time -->
                                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                            <div>
                                                <label class="block text-xs font-medium text-gray-600 mb-2">Start time</label>
                                                <h:inputText id="editStartTime"
                                                             value="#{customerMyBookingsBean.editStartTime}"
                                                             pass:type="time"
                                                             styleClass="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-2.5 text-sm text-gray-800
                                                             focus:outline-none focus:ring-2 focus:ring-[#D4AF37]/40">
                                                    <f:convertDateTime pattern="HH:mm"/>
                                                </h:inputText>
                                            </div>
                                            <div>
                                                <label class="block text-xs font-medium text-gray-600 mb-2">End time</label>
                                                <h:inputText id="editEndTime"
                                                             value="#{customerMyBookingsBean.editEndTime}"
                                                             pass:type="time"
                                                             styleClass="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-2.5 text-sm text-gray-800
                                                             focus:outline-none focus:ring-2 focus:ring-[#D4AF37]/40">
                                                    <f:convertDateTime pattern="HH:mm"/>
                                                </h:inputText>
                                                <h:message for="editEndTime" styleClass="block mt-2 text-xs text-red-600"/>
                                            </div>
                                        </div>

                                        <!-- Guests -->
                                        <div>
                                            <label class="block text-xs font-medium text-gray-600 mb-2">Guest count</label>
                                            <h:inputText id="editGuestCount"
                                                         value="#{customerMyBookingsBean.editGuestCount}"
                                                         pass:type="number"
                                                         pass:min="#{customerMyBookingsBean.editGuestMin}"
                                                         pass:max="#{customerMyBookingsBean.editGuestMax}"
                                                         styleClass="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-2.5 text-sm text-gray-800
                                                         focus:outline-none focus:ring-2 focus:ring-[#D4AF37]/40"/>
                                            <h:message for="editGuestCount" styleClass="block mt-2 text-xs text-red-600"/>
                                            <p class="mt-2 text-xs text-gray-500">
                                                Allowed range: #{customerMyBookingsBean.editGuestMin} – #{customerMyBookingsBean.editGuestMax} guests.
                                            </p>

                                        </div>

                                        <!-- Location -->
                                        <div>
                                            <label class="block text-xs font-medium text-gray-600 mb-2">Location</label>
                                            <h:selectOneMenu id="editLocationType"
                                                             value="#{customerMyBookingsBean.editLocationType}"
                                                             onchange="toggleEditOutside()"
                                                             styleClass="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-2.5 text-sm text-gray-800
                                                             focus:outline-none focus:ring-2 focus:ring-[#D4AF37]/40">
                                                <f:selectItem itemValue="AT_RESTAURANT" itemLabel="At restaurant"/>
                                                <f:selectItem itemValue="OUTSIDE" itemLabel="Outside"/>
                                            </h:selectOneMenu>
                                        </div>

                                        <div id="editOutsideWrap" class="#{customerMyBookingsBean.editOutside ? '' : 'hidden'}">
                                            <label class="block text-xs font-medium text-gray-600 mb-2">Outside address</label>
                                            <h:inputText id="editOutsideAddress"
                                                         value="#{customerMyBookingsBean.editOutsideAddress}"
                                                         styleClass="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-2.5 text-sm text-gray-800
                                                         focus:outline-none focus:ring-2 focus:ring-[#D4AF37]/40"/>
                                            <h:message for="editOutsideAddress" styleClass="block mt-2 text-xs text-red-600"/>
                                        </div>

                                        <!-- Note -->
                                        <div>
                                            <label class="block text-xs font-medium text-gray-600 mb-2">Note</label>
                                            <h:inputTextarea id="editNote"
                                                             value="#{customerMyBookingsBean.editNote}"
                                                             rows="3"
                                                             styleClass="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-2.5 text-sm text-gray-800
                                                             focus:outline-none focus:ring-2 focus:ring-[#D4AF37]/40"/>
                                        </div>

                                    </div>

                                    <div class="px-6 py-5 border-t border-gray-100 flex items-center justify-end gap-3 bg-gray-50">
                                        <button type="button"
                                                class="px-4 py-2.5 rounded-2xl border border-gray-200 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"
                                                onclick="closeCustomerEditModal()">Back</button>

                                        <h:commandButton value="Save changes"
                                                         action="#{customerMyBookingsBean.saveEdit}"
                                                         styleClass="px-5 py-2.5 rounded-2xl bg-[#D4AF37] text-[#111827] text-sm font-semibold hover:brightness-95 transition-all shadow-sm">
                                            <f:ajax execute=":myBookingsForm:editBookingId
                                                    :myBookingsForm:editEventDate
                                                    :myBookingsForm:editStartTime
                                                    :myBookingsForm:editEndTime
                                                    :myBookingsForm:editGuestCount
                                                    :myBookingsForm:editLocationType
                                                    :myBookingsForm:editOutsideAddress
                                                    :myBookingsForm:editNote"
                                                    render=":myBookingsForm:editModal :myBookingsForm:msgs"
                                                    onevent="feastlinkCustomerSaveEditEvent"/>
                                        </h:commandButton>
                                    </div>
                                </div>
                            </div>
                        </h:panelGroup>
                        <!-- DELETE MODAL -->
                        <h:panelGroup id="deleteModal">
                            <h:inputHidden id="deleteOk" value="#{customerMyBookingsBean.deleteSuccess}"/>
                            <h:inputHidden id="deleteBookingId" value="#{customerMyBookingsBean.deleteBookingId}"/>

                            <div id="customerDeleteModal" class="fixed inset-0 z-50 hidden">
                                <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeCustomerDeleteModal()"></div>

                                <div class="relative mx-auto mt-10 sm:mt-16 w-[92%] max-w-xl rounded-3xl bg-white shadow-2xl border border-gray-100 overflow-hidden">
                                    <div class="px-6 py-5 border-b border-gray-100 flex items-center justify-between">
                                        <div>
                                            <p class="text-[11px] uppercase tracking-widest text-gray-500">Delete quotation</p>
                                            <p class="text-lg font-semibold text-[#0B1120]">Delete this draft booking?</p>
                                            <p class="mt-2 text-sm text-gray-500">
                                                This action cannot be undone.
                                            </p>
                                        </div>
                                        <button type="button"
                                                class="w-10 h-10 rounded-2xl flex items-center justify-center bg-gray-50 hover:bg-gray-100 text-gray-700"
                                                onclick="closeCustomerDeleteModal()">✕</button>
                                    </div>

                                    <div class="px-6 py-6 space-y-3">
                                        <p class="text-sm text-gray-700">
                                            You are about to delete your saved quotation. If you want to book later, you can create a new booking again.
                                        </p>
                                    </div>

                                    <div class="px-6 py-5 border-t border-gray-100 flex items-center justify-end gap-3 bg-gray-50">
                                        <button type="button"
                                                class="px-4 py-2.5 rounded-2xl border border-gray-200 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"
                                                onclick="closeCustomerDeleteModal()">Back</button>

                                        <h:commandButton value="Yes, delete"
                                                         action="#{customerMyBookingsBean.confirmDeleteQuotation}"
                                                         styleClass="px-5 py-2.5 rounded-2xl bg-[#EF4444] text-white text-sm font-semibold hover:bg-[#DC2626] transition-all shadow-sm">
                                            <f:ajax execute=":myBookingsForm:deleteBookingId"
                                                    render=":myBookingsForm:deleteModal :myBookingsForm:msgs"
                                                    onevent="feastlinkCustomerConfirmDeleteEvent"/>
                                        </h:commandButton>
                                    </div>
                                </div>
                            </div>
                        </h:panelGroup>

                        <!-- CANCEL MODAL -->
                        <h:panelGroup id="cancelModal">
                            <!-- flag để JS biết cancel ok chưa -->
                            <h:inputHidden id="cancelOk" value="#{customerMyBookingsBean.cancelSuccess}"/>

                            <!-- bookingId để confirmCancel biết đang cancel booking nào -->
                            <h:inputHidden id="cancelBookingId" value="#{customerMyBookingsBean.cancelBookingId}"/>

                            <div id="customerCancelModal" class="fixed inset-0 z-50 hidden">
                                <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeCustomerCancelModal()"></div>

                                <div class="relative mx-auto mt-10 sm:mt-16 w-[92%] max-w-xl rounded-3xl bg-white shadow-2xl border border-gray-100 overflow-hidden">
                                    <div class="px-6 py-5 border-b border-gray-100 flex items-center justify-between">
                                        <div>
                                            <p class="text-[11px] uppercase tracking-widest text-gray-500">Cancel booking</p>
                                            <p class="text-lg font-semibold text-[#0B1120]">
                                                Provide a cancellation reason
                                            </p>
                                            <h:panelGroup rendered="#{customerMyBookingsBean.cancelPolicyHint ne ''}">
                                                <p class="mt-2 text-sm text-gray-500">
                                                    #{customerMyBookingsBean.cancelPolicyHint}
                                                </p>
                                            </h:panelGroup>

                                        </div>
                                        <button type="button"
                                                class="w-10 h-10 rounded-2xl flex items-center justify-center bg-gray-50 hover:bg-gray-100 text-gray-700"
                                                onclick="closeCustomerCancelModal()">✕</button>
                                    </div>

                                    <div class="px-6 py-6 space-y-3">
                                        <p class="text-sm text-gray-600">
                                            Please tell us why you want to cancel. This reason will be saved with your booking.
                                        </p>

                                        <div>
                                            <label class="block text-xs font-medium text-gray-600 mb-2">Cancellation reason</label>

                                            <h:inputTextarea id="cancelReason"
                                                             value="#{customerMyBookingsBean.cancelReason}"
                                                             rows="4"
                                                             required="true"
                                                             requiredMessage="Please enter a cancellation reason."
                                                             styleClass="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-2.5 text-sm text-gray-800
                                                             focus:outline-none focus:ring-2 focus:ring-[#EF4444]"/>

                                            <!-- để lỗi required hiện ngay dưới ô -->
                                            <h:message for="cancelReason" styleClass="block mt-2 text-xs text-red-600"/>
                                        </div>
                                    </div>

                                    <div class="px-6 py-5 border-t border-gray-100 flex items-center justify-end gap-3 bg-gray-50">
                                        <button type="button"
                                                class="px-4 py-2.5 rounded-2xl border border-gray-200 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"
                                                onclick="closeCustomerCancelModal()">Back</button>

                                        <h:commandButton value="Confirm Cancel"
                                                         action="#{customerMyBookingsBean.confirmCancel}"
                                                         styleClass="px-5 py-2.5 rounded-2xl bg-[#EF4444] text-white text-sm font-semibold hover:bg-[#DC2626] transition-all shadow-sm">
                                            <f:ajax execute=":myBookingsForm:cancelBookingId :myBookingsForm:cancelReason"
                                                    render=":myBookingsForm:cancelModal :myBookingsForm:msgs"
                                                    onevent="feastlinkCustomerConfirmCancelEvent"/>
                                        </h:commandButton>
                                    </div>
                                </div>
                            </div>
                        </h:panelGroup>


                    </h:form>
                </h:panelGroup>
            </div>
        </main>

        <ui:include src="/layout/footer.xhtml" />

        <!-- JS: lucide + filter -->
        <script type="text/javascript">
            //<![CDATA[
            document.addEventListener('DOMContentLoaded', function () {
                if (window.lucide) {
                    window.lucide.createIcons();
                }

                // =========================
                // FILTER STATE (PERSIST)
                // =========================
                var STORAGE_KEY = 'feastlink_mybookings_filters';

                // Defaults
                var statusFilter = 'all';
                var searchRaw = '';
                var searchQuery = '';
                var sortOrder = 'newest';
                var restaurantFilter = 'all';

                // DOM refs
                var cards = Array.prototype.slice.call(document.querySelectorAll('[data-role="booking-card"]'));
                var emptyFilter = document.getElementById('empty-filter-state');
                var listContainer = document.getElementById('bookings-list');

                var sortSelect = document.getElementById('sort-select');
                var restaurantSelect = document.getElementById('restaurant-select');
                var searchInput = document.getElementById('search-input');
                var clearBtn = document.getElementById('clear-filters-btn');

                // =========================
                // STORAGE HELPERS
                // =========================
                function saveFilters() {
                    try {
                        sessionStorage.setItem(STORAGE_KEY, JSON.stringify({
                            status: statusFilter,
                            q: searchRaw || '',
                            sort: sortOrder,
                            restaurant: restaurantFilter
                        }));
                    } catch (e) {
                    }
                }

                function loadFilters() {
                    try {
                        var raw = sessionStorage.getItem(STORAGE_KEY);
                        if (!raw)
                            return;
                        var obj = JSON.parse(raw);

                        statusFilter = obj.status || 'all';
                        searchRaw = obj.q || '';
                        searchQuery = (searchRaw || '').toLowerCase();
                        sortOrder = obj.sort || 'newest';
                        restaurantFilter = obj.restaurant || 'all';
                    } catch (e) {
                    }
                }

                function syncUIFromState() {
                    if (searchInput)
                        searchInput.value = searchRaw || '';
                    if (sortSelect)
                        sortSelect.value = sortOrder || 'newest';
                    if (restaurantSelect)
                        restaurantSelect.value = restaurantFilter || 'all';
                    updateStatusTabs();
                }

                // =========================
                // MATCHERS
                // =========================
                function matchesRestaurant(card) {
                    if (!restaurantFilter || restaurantFilter === 'all')
                        return true;
                    var rid = card.getAttribute('data-restaurant-id') || '';
                    return rid === restaurantFilter;
                }

                function matchesStatus(card) {
                    var status = (card.getAttribute('data-booking-status') || '').toUpperCase();
                    if (statusFilter === 'all')
                        return true;

                    if (statusFilter === 'pending')
                        return status === 'PENDING';
                    if (statusFilter === 'confirmed')
                        return status === 'CONFIRMED';
                    if (statusFilter === 'upcoming')
                        return status === 'PENDING' || status === 'CONFIRMED';
                    if (statusFilter === 'completed')
                        return status === 'COMPLETED';
                    if (statusFilter === 'cancelled')
                        return status === 'CANCELLED';

                    return true;
                }

                function matchesSearch(card) {
                    if (!searchQuery)
                        return true;
                    var code = (card.getAttribute('data-booking-code') || '').toLowerCase();
                    var name = (card.getAttribute('data-restaurant-name') || '').toLowerCase();
                    return code.indexOf(searchQuery) !== -1 || name.indexOf(searchQuery) !== -1;
                }

                // =========================
                // UI: STATUS TABS STYLE
                // =========================
                function updateStatusTabs() {
                    var activeClasses =
                            'px-6 py-2.5 rounded-full font-medium whitespace-nowrap transition-all duration-300 bg-[#0B1120] text-white border-2 border-[#D4AF37] shadow-md shadow-[#D4AF37]/20';
                    var inactiveClasses =
                            'px-6 py-2.5 rounded-full font-medium whitespace-nowrap transition-all duration-300 bg-white text-[#4B5563] border-2 border-[#E5E7EB] hover:border-[#E6C77F] hover:text-[#D4AF37]';

                    document.querySelectorAll('[data-role="status-tab"]').forEach(function (btn) {
                        var value = btn.getAttribute('data-filter-value');
                        btn.setAttribute('class', (value === statusFilter) ? activeClasses : inactiveClasses);
                    });
                }

                // =========================
                // SORT + APPLY
                // =========================
                function sortCards() {
                    if (!listContainer)
                        return;

                    cards.sort(function (a, b) {
                        var aVal = parseInt(a.getAttribute('data-created-at') || '0', 10);
                        var bVal = parseInt(b.getAttribute('data-created-at') || '0', 10);

                        if (isNaN(aVal))
                            aVal = 0;
                        if (isNaN(bVal))
                            bVal = 0;

                        if (sortOrder === 'oldest')
                            return aVal - bVal;  // old -> new
                        return bVal - aVal;                              // new -> old
                    });

                    // Re-append theo thứ tự mới
                    cards.forEach(function (card) {
                        listContainer.appendChild(card);
                    });
                }

                function applyFilters() {
                    var visibleCount = 0;

                    cards.forEach(function (card) {
                        var ok = matchesStatus(card) && matchesSearch(card) && matchesRestaurant(card);
                        if (ok) {
                            card.classList.remove('hidden');
                            visibleCount++;
                        } else {
                            card.classList.add('hidden');
                        }
                    });

                    if (emptyFilter) {
                        if (visibleCount === 0)
                            emptyFilter.classList.remove('hidden');
                        else
                            emptyFilter.classList.add('hidden');
                    }
                }

                // =========================
                // EVENT BINDINGS
                // =========================
                // Tabs click
                document.querySelectorAll('[data-role="status-tab"]').forEach(function (btn) {
                    btn.addEventListener('click', function () {
                        statusFilter = btn.getAttribute('data-filter-value') || 'all';
                        updateStatusTabs();
                        saveFilters();
                        applyFilters();
                    });
                });

                // Search input
                if (searchInput) {
                    searchInput.addEventListener('input', function (e) {
                        searchRaw = (e.target.value || '');
                        searchQuery = searchRaw.toLowerCase();
                        saveFilters();
                        applyFilters();
                    });
                }

                // Sort select
                if (sortSelect) {
                    sortSelect.addEventListener('change', function (e) {
                        sortOrder = e.target.value || 'newest';
                        saveFilters();
                        sortCards();
                        applyFilters();
                    });
                }

                // Restaurant select
                if (restaurantSelect) {
                    restaurantSelect.addEventListener('change', function (e) {
                        restaurantFilter = e.target.value || 'all';
                        saveFilters();
                        applyFilters();
                    });
                }

                // Clear button
                if (clearBtn) {
                    clearBtn.addEventListener('click', function () {
                        statusFilter = 'all';
                        searchRaw = '';
                        searchQuery = '';
                        sortOrder = 'newest';
                        restaurantFilter = 'all';

                        try {
                            sessionStorage.removeItem(STORAGE_KEY);
                        } catch (e) {
                        }

                        syncUIFromState();
                        sortCards();
                        applyFilters();

                        if (window.lucide)
                            window.lucide.createIcons();
                    });
                }

                // =========================
                // INIT
                // =========================
                loadFilters();
                syncUIFromState();
                sortCards();
                applyFilters();
            });

            // ====== MODAL / EDIT / CANCEL / DELETE (GIỮ NGUYÊN CỦA BRO) ======
            function openCustomerEditModal() {
                var m = document.getElementById('customerEditModal');
                if (m)
                    m.classList.remove('hidden');
            }

            function toggleEditOutside() {
                var sel = document.getElementById('myBookingsForm:editLocationType');
                var wrap = document.getElementById('editOutsideWrap');
                if (!sel || !wrap)
                    return;

                var v = (sel.value || '').toUpperCase();
                if (v === 'OUTSIDE')
                    wrap.classList.remove('hidden');
                else
                    wrap.classList.add('hidden');
            }

            function closeCustomerEditModal() {
                var m = document.getElementById('customerEditModal');
                if (m)
                    m.classList.add('hidden');
            }

            function feastlinkCustomerEditEvent(data) {
                if (data.status === 'success') {
                    setTimeout(function () {
                        openCustomerEditModal();
                        toggleEditOutside();
                        if (window.lucide)
                            window.lucide.createIcons();
                    }, 0);
                }
            }

            function feastlinkCustomerSaveEditEvent(data) {
                if (data.status !== 'success')
                    return;
                var okEl = document.getElementById('myBookingsForm:editSaveOk');
                var ok = okEl && (okEl.value === 'true' || okEl.value === 'True');
                if (ok) {
                    window.location.reload();
                } else {
                    openCustomerEditModal();
                    if (window.lucide)
                        window.lucide.createIcons();
                }
            }

            function openCustomerCancelModal() {
                var m = document.getElementById('customerCancelModal');
                if (m)
                    m.classList.remove('hidden');
            }
            function closeCustomerCancelModal() {
                var m = document.getElementById('customerCancelModal');
                if (m)
                    m.classList.add('hidden');
            }

            function feastlinkCustomerPrepareCancelEvent(data) {
                if (data.status !== 'success')
                    return;

                var idEl = document.getElementById('myBookingsForm:cancelBookingId');
                if (!idEl || !idEl.value)
                    return;

                openCustomerCancelModal();
                if (window.lucide)
                    window.lucide.createIcons();
            }

            function feastlinkCustomerConfirmCancelEvent(data) {
                if (data.status !== 'success')
                    return;

                var okEl = document.getElementById('myBookingsForm:cancelOk');
                var ok = okEl && (okEl.value === 'true' || okEl.value === 'True');

                if (ok) {
                    window.location.reload();
                } else {
                    openCustomerCancelModal();
                    if (window.lucide)
                        window.lucide.createIcons();
                }
            }

            function openCustomerDeleteModal() {
                var m = document.getElementById('customerDeleteModal');
                if (m)
                    m.classList.remove('hidden');
            }
            function closeCustomerDeleteModal() {
                var m = document.getElementById('customerDeleteModal');
                if (m)
                    m.classList.add('hidden');
            }

            function feastlinkCustomerPrepareDeleteEvent(data) {
                if (data.status !== 'success')
                    return;

                var idEl = document.getElementById('myBookingsForm:deleteBookingId');
                if (!idEl || !idEl.value)
                    return;

                openCustomerDeleteModal();
                if (window.lucide)
                    window.lucide.createIcons();
            }

            function feastlinkCustomerConfirmDeleteEvent(data) {
                if (data.status !== 'success')
                    return;

                var okEl = document.getElementById('myBookingsForm:deleteOk');
                var ok = okEl && (okEl.value === 'true' || okEl.value === 'True');

                if (ok) {
                    window.location.reload();
                } else {
                    openCustomerDeleteModal();
                    if (window.lucide)
                        window.lucide.createIcons();
                }
            }
            //]]>
        </script>

    </h:body>
</html>
