<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets"
      xmlns:pass="jakarta.faces.passthrough">

<h:head>
    <meta charset="UTF-8" />
    <title>FeastLink – Offers &amp; Reward Points</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style type="text/css">
        @keyframes floatCard {
            0%   { transform: translateY(0); }
            50%  { transform: translateY(-4px); }
            100% { transform: translateY(0); }
        }
        .card-floating:hover {
            animation: floatCard 0.8s ease-in-out infinite;
        }
        html {
            scroll-behavior: smooth;
        }
        body {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</h:head>

<h:body class="bg-[#020617]">

    <!-- HEADER -->
    <ui:include src="/layout/header.xhtml" />

    <main class="pt-24 pb-16 min-h-screen bg-gradient-to-b from-[#020617] via-[#020617] to-[#020617]">
        <div class="max-w-[1200px] mx-auto px-4 lg:px-6">

            <!-- Title + description -->
            <div class="mb-10">
                <p class="text-xs font-semibold tracking-[0.2em] text-[#FACC6B] uppercase">
                    Rewards &amp; perks
                </p>
                <h1 class="mt-2 text-3xl md:text-4xl font-bold text-white">
                    Your FeastLink offers &amp; points
                </h1>
                <p class="mt-3 text-sm md:text-base text-[#E5E7EB] max-w-2xl">
                    Collect reward points from your bookings and redeem exclusive vouchers for
                    future celebrations.
                </p>
            </div>

            <h:form id="offersForm" prependId="false">

                <!-- Global messages -->
                <h:messages globalOnly="true"
                            styleClass="mb-4 text-sm"
                            errorClass="text-red-400"
                            infoClass="text-emerald-300"
                            warnClass="text-amber-300" />

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

                    <!-- LEFT: POINT WALLET -->
                    <section class="lg:col-span-1 space-y-4">

                        <!-- Wallet card -->
                        <div
                            class="card-floating relative overflow-hidden rounded-[24px] border border-[#1F2937] bg-gradient-to-br from-[#020617] via-[#020617] to-[#0B1120] shadow-[0_20px_60px_rgba(0,0,0,0.7)]">
                            <!-- glow -->
                            <div class="pointer-events-none absolute inset-0 opacity-60">
                                <div class="absolute -top-20 -left-10 w-48 h-48 bg-[#FACC6B]/20 blur-3xl"></div>
                                <div class="absolute -bottom-24 right-0 w-72 h-72 bg-[#22C55E]/10 blur-3xl"></div>
                            </div>

                            <div class="relative p-6 md:p-7">
                                <div class="flex items-center justify-between mb-3">
                                    <div>
                                        <p class="text-xs font-semibold tracking-[0.2em] text-[#9CA3AF] uppercase">
                                            My points
                                        </p>
                                        <h2 class="mt-2 text-2xl font-bold text-white">
                                            <h:outputText value="#{customerOffersBean.wallet.currentPoints}">
                                                <f:convertNumber groupingUsed="true" />
                                            </h:outputText>
                                            <span class="text-sm font-medium text-[#E5E7EB]"> pts</span>
                                        </h2>
                                    </div>

                                    <div
                                        class="inline-flex items-center justify-center rounded-full border border-[#FACC6B]/60 bg-[#FACC6B]/10 px-3 py-1 text-xs font-semibold text-[#FACC6B]">
                                        <i data-lucide="sparkles" class="w-3.5 h-3.5 mr-1"></i>
                                        Level: Gold
                                    </div>
                                </div>

                                <p class="text-xs text-[#E5E7EB]/80 mb-4">
                                    Earn points from every confirmed booking. Redeem them for exclusive vouchers,
                                    upgrades and add-ons.
                                </p>

                                <div
                                    class="flex items-center justify-between rounded-2xl border border-[#1F2937] bg-[#020617]/60 px-4 py-3 mb-4">
                                    <div class="flex items-center gap-3 text-xs text-[#E5E7EB]">
                                        <div
                                            class="flex h-9 w-9 items-center justify-center rounded-xl bg-[#111827] border border-[#FACC6B]/40">
                                            <i data-lucide="calendar-star" class="w-4 h-4 text-[#FACC6B]"></i>
                                        </div>
                                        <div>
                                            <p class="font-medium">
                                                Last updated
                                            </p>
                                            <p class="text-[11px] text-[#9CA3AF]">
                                                <h:outputText value="#{customerOffersBean.wallet.updatedAt}">
                                                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm"
                                                                       timeZone="Asia/Ho_Chi_Minh" />
                                                </h:outputText>
                                            </p>
                                        </div>
                                    </div>
                                    <div class="text-right text-[11px] text-[#9CA3AF]">
                                        <p>Base earn rate</p>
                                        <p class="font-semibold text-[#FACC6B]">1 pt per 100,000đ</p>
                                    </div>
                                </div>

                                <!-- Test add points button -->
                                <div class="flex flex-col gap-2 text-xs text-[#E5E7EB]/80">
                                    <h:commandButton value="+100 test points"
                                                     action="#{customerOffersBean.addTestPoints}"
                                                     styleClass="w-full mb-1 inline-flex items-center justify-center gap-2 rounded-xl bg-gradient-to-r from-[#22C55E] to-[#16A34A] px-4 py-2.5 text-sm font-semibold text-white shadow-lg shadow-[#16A34A]/40 hover:shadow-xl hover:-translate-y-0.5 transition-all duration-200">
                                        <i data-lucide="plus" class="w-4 h-4"></i>
                                    </h:commandButton>

                                    <p class="text-[11px] text-[#9CA3AF]">
                                        *Nút này chỉ dùng để test: giúp bạn kiểm tra việc cập nhật CSDL (PointWallets)
                                        có hoạt động chính xác hay không.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Info card -->
                        <div
                            class="rounded-2xl border border-[#111827] bg-[#020617] px-5 py-4 text-xs text-[#E5E7EB]/80 space-y-2">
                            <div class="flex items-center gap-2 text-[#FACC6B]">
                                <i data-lucide="info" class="w-4 h-4"></i>
                                <span class="font-semibold">How points work</span>
                            </div>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>Points are awarded after your booking is confirmed and paid.</li>
                                <li>You can redeem points for vouchers shown on this page.</li>
                                <li>Some vouchers may have minimum order amount or expiry date.</li>
                            </ul>
                        </div>
                    </section>

                    <!-- RIGHT: OFFERS LIST -->
                    <section class="lg:col-span-2">
                        <div
                            class="mb-4 flex items-center justify-between gap-3 flex-wrap">
                            <div>
                                <h2 class="text-lg font-semibold text-white">
                                    Available offers
                                </h2>
                                <p class="text-xs text-[#9CA3AF]">
                                    Vouchers you can redeem with your current points balance.
                                </p>
                            </div>
                        </div>

                        <!-- No offers -->
                        <h:panelGroup rendered="#{empty customerOffersBean.redeemableOffers}">
                            <div
                                class="rounded-2xl border border-dashed border-[#374151] bg-[#020617] px-6 py-8 text-center text-sm text-[#9CA3AF]">
                                <p class="mb-1 font-medium text-[#E5E7EB]">
                                    There are no redeemable offers at the moment.
                                </p>
                                <p>
                                    Check back after your next booking, or when new campaigns are launched.
                                </p>
                            </div>
                        </h:panelGroup>

                        <!-- Offers list -->
                        <h:panelGroup rendered="#{not empty customerOffersBean.redeemableOffers}">
                            <div class="space-y-4">
                                <ui:repeat value="#{customerOffersBean.redeemableOffers}" var="offer">
                                    <div
                                        class="relative overflow-hidden rounded-2xl border border-[#1F2937] bg-[#020617] px-5 py-4 md:px-6 md:py-5 flex flex-col md:flex-row md:items-center gap-4">
                                        <!-- left glow -->
                                        <div class="pointer-events-none absolute inset-y-0 left-0 w-32 opacity-60">
                                            <div class="absolute -left-16 top-0 h-32 w-32 bg-[#FACC6B]/10 blur-3xl"></div>
                                        </div>

                                        <!-- main content -->
                                        <div class="relative flex-1 flex flex-col gap-2">
                                            <div class="flex items-center gap-2 flex-wrap">
                                                <span
                                                    class="inline-flex items-center justify-center rounded-full border border-[#FACC6B]/50 bg-[#FACC6B]/10 px-3 py-1 text-[11px] font-semibold text-[#FACC6B]">
                                                    <i data-lucide="tag" class="w-3.5 h-3.5 mr-1"></i>
                                                    <h:outputText value="#{offer.code}" />
                                                </span>
                                                <h3 class="text-sm md:text-base font-semibold text-white">
                                                    <h:outputText value="#{offer.name}" />
                                                </h3>
                                            </div>

                                            <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-[11px] text-[#E5E7EB]/80 mt-2">
                                                <div>
                                                    <p class="text-[#9CA3AF]">Discount</p>
                                                    <p class="font-semibold text-[#FACC6B]">
                                                        <ui:fragment rendered="#{offer.discountType eq 'PERCENT'}">
                                                            <h:outputText value="#{offer.discountValue}" />
                                                            <span>%</span>
                                                        </ui:fragment>
                                                        <ui:fragment rendered="#{offer.discountType eq 'AMOUNT'}">
                                                            <h:outputText value="#{offer.discountValue}">
                                                                <f:convertNumber groupingUsed="true" />
                                                            </h:outputText>
                                                            <span> đ</span>
                                                        </ui:fragment>
                                                    </p>
                                                </div>

                                                <div>
                                                    <p class="text-[#9CA3AF]">Max discount</p>
                                                    <p class="font-semibold">
                                                        <h:panelGroup rendered="#{offer.maxDiscount ne null}">
                                                            <h:outputText value="#{offer.maxDiscount}">
                                                                <f:convertNumber groupingUsed="true" />
                                                            </h:outputText> đ
                                                        </h:panelGroup>
                                                        <h:panelGroup rendered="#{offer.maxDiscount eq null}">
                                                            —
                                                        </h:panelGroup>
                                                    </p>
                                                </div>

                                                <div>
                                                    <p class="text-[#9CA3AF]">Min order</p>
                                                    <p class="font-semibold">
                                                        <h:panelGroup rendered="#{offer.minOrderAmount ne null}">
                                                            <h:outputText value="#{offer.minOrderAmount}">
                                                                <f:convertNumber groupingUsed="true" />
                                                            </h:outputText> đ
                                                        </h:panelGroup>
                                                        <h:panelGroup rendered="#{offer.minOrderAmount eq null}">
                                                            None
                                                        </h:panelGroup>
                                                    </p>
                                                </div>

                                                <div>
                                                    <p class="text-[#9CA3AF]">Point cost</p>
                                                    <p class="font-semibold text-[#22C55E]">
                                                        <h:outputText value="#{offer.pointCost}" /> pts
                                                    </p>
                                                </div>
                                            </div>

                                            <div class="mt-2 flex items-center gap-2 text-[11px] text-[#9CA3AF]">
                                                <i data-lucide="clock" class="w-3.5 h-3.5"></i>
                                                <span>
                                                    Valid:
                                                    <h:outputText value="#{offer.startAt}">
                                                        <f:convertDateTime pattern="dd/MM/yyyy"
                                                                           timeZone="Asia/Ho_Chi_Minh" />
                                                    </h:outputText>
                                                    –
                                                    <h:outputText value="#{offer.endAt}">
                                                        <f:convertDateTime pattern="dd/MM/yyyy"
                                                                           timeZone="Asia/Ho_Chi_Minh" />
                                                    </h:outputText>
                                                </span>
                                            </div>
                                        </div>

                                        <!-- Redeem action -->
                                        <div class="relative flex-shrink-0 w-full md:w-auto">
                                            <h:commandButton value="Redeem now"
                                                             action="#{customerOffersBean.redeemVoucher(offer)}"
                                                             styleClass="w-full inline-flex items-center justify-center gap-2 rounded-xl bg-gradient-to-r from-[#F97316] to-[#EAB308] px-5 py-2.5 text-sm font-semibold text-white shadow-lg shadow-[#F97316]/40 hover:shadow-xl hover:-translate-y-0.5 transition-all duration-200">
                                                <i data-lucide="gift" class="w-4 h-4"></i>
                                            </h:commandButton>
                                        </div>
                                    </div>
                                </ui:repeat>
                            </div>
                        </h:panelGroup>
                    </section>
                </div>
            </h:form>
        </div>
    </main>

    <!-- FOOTER -->
    <ui:include src="/layout/footer.xhtml" />

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            if (window.lucide) {
                window.lucide.createIcons();
            }
        });
    </script>

</h:body>
</html>
