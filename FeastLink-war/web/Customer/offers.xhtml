<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets">

<h:head>
    <meta charset="UTF-8" />
    <title>FeastLink – Offers &amp; Reward Points</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style type="text/css">
        :root {
            --navy: #0B1120;
            --navy-dark: #020617;
            --gold: #D4AF37;
            --gold-soft: #E6C77F;
            --bg-soft: #F9FAFB;
            --bg-alt: #F5F5F4;
            --border: #E5E7EB;
            --text-main: #111827;
            --text-muted: #6B7280;
            --accent-orange: #F97316;
            --accent-gold: #EAB308;
            --success: #22C55E;
        }

        @keyframes floatCard {
            0%   { transform: translateY(0); }
            50%  { transform: translateY(-4px); }
            100% { transform: translateY(0); }
        }

        .card-floating:hover {
            animation: floatCard 0.8s ease-in-out infinite;
        }

        .thin-scroll::-webkit-scrollbar {
            height: 6px;
        }

        .thin-scroll::-webkit-scrollbar-track {
            background: rgba(15,23,42,0.12);
        }

        .thin-scroll::-webkit-scrollbar-thumb {
            background: rgba(148,163,184,0.7);
            border-radius: 999px;
        }
    </style>
</h:head>

<h:body class="bg-[var(--bg-soft)] text-[var(--text-main)]">

    <!-- HEADER -->
    <ui:include src="/layout/header.xhtml" />

    <main class="pt-24 pb-16 min-h-screen">
        <div class="max-w-[1200px] mx-auto px-4 lg:px-6">

            <!-- HERO INTRO -->
            <section
                    class="mb-10 rounded-[24px] border border-[rgba(148,163,184,0.45)] bg-gradient-to-br from-[rgba(4,7,17,0.98)] via-[rgba(2,6,23,1)] to-[rgba(15,23,42,1)] shadow-[0_24px_80px_rgba(15,23,42,0.95)] overflow-hidden relative">
                <div class="pointer-events-none absolute inset-0 opacity-70">
                    <div class="absolute -top-24 -left-10 w-56 h-56 bg-[rgba(248,250,252,0.08)] blur-3xl"></div>
                    <div class="absolute -top-20 right-0 w-72 h-72 bg-[rgba(212,175,55,0.25)] blur-3xl"></div>
                </div>

                <div class="relative grid grid-cols-1 md:grid-cols-[1.6fr,1.1fr] gap-6 px-6 md:px-8 py-7">
                    <!-- Left text -->
                    <div>
                        <p class="text-[11px] md:text-xs font-semibold tracking-[0.28em] uppercase text-[#E6C77F]">
                            Rewards &amp; Perks
                        </p>
                        <h1 class="mt-2 text-2xl md:text-3xl font-bold text-white">
                            FeastLink Reward Points &amp; Exclusive Offers
                        </h1>
                        <p class="mt-3 text-sm md:text-[15px] text-[#E5E7EB] max-w-xl">
                           Every time you book a party, you accumulate points. Redeem your points for discount vouchers,

                            service upgrades, and special offers for future parties.
                        </p>
                        <div class="mt-4 flex flex-wrap gap-2">
                            <span
                                    class="inline-flex items-center px-3 py-1 rounded-full border border-[rgba(249,250,251,0.6)] bg-[rgba(15,23,42,0.5)] text-[11px] text-[#E5E7EB]">
                              Current rank:
                                <span class="ml-1 font-semibold text-[var(--gold-soft)]">Gold Member</span>
                            </span>
                            <span
                                    class="inline-flex items-center px-3 py-1 rounded-full border border-[rgba(249,250,251,0.25)] bg-[rgba(15,23,42,0.35)] text-[11px] text-[#E5E7EB]">
                               This offer is only available for logged-in accounts.
                            </span>
                        </div>
                    </div>

                    <!-- Right summary: khác giữa loggedIn / not loggedIn -->
                    <!-- ✅ Khi đã login: hiển thị ví điểm -->
                    <h:panelGroup rendered="#{customerOffersBean.loggedIn}">
                        <div
                                class="card-floating rounded-2xl border border-[rgba(148,163,184,0.5)] bg-[rgba(15,23,42,0.95)] px-4 py-4 shadow-[0_18px_50px_rgba(15,23,42,0.9)] flex flex-col gap-3">
                            <div class="flex items-center justify-between">
                                <p class="text-xs font-semibold tracking-[0.18em] text-[#9CA3AF] uppercase">
                                    Points Overview
                                </p>
                                <span
                                        class="inline-flex items-center px-3 py-1 rounded-full border border-[rgba(212,175,55,0.6)] bg-[rgba(212,175,55,0.12)] text-[10px] font-semibold text-[var(--gold-soft)] uppercase tracking-[0.16em]">
                                    Real-time Sync
                                </span>
                            </div>
                            <div class="flex items-end justify-between gap-3">
                                <div>
                                    <p class="text-[11px] text-[#9CA3AF] mb-1">Current balance</p>
                                    <p class="text-2xl font-bold text-white">
                                        <h:outputText value="#{customerOffersBean.wallet.currentPoints}">
                                            <f:convertNumber groupingUsed="true" />
                                        </h:outputText>
                                        <span class="ml-1 text-sm font-medium text-[#E5E7EB]">pts</span>
                                    </p>
                                </div>
                                <div class="text-right text-[11px] text-[#9CA3AF]">
                                    <p>Base earn rate</p>
                                    <p class="mt-0.5 font-semibold text-[var(--gold-soft)]">
                                        <h:outputText value="#{customerOffersBean.pointsPerAmount}" /> pts /
                                        <h:outputText value="#{customerOffersBean.amountPerPoint}">
                                            <f:convertNumber groupingUsed="true" />
                                        </h:outputText> 
                                    </p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-3 border-t border-[rgba(55,65,81,0.6)] pt-3 mt-1">
                                <div class="text-[11px] text-[#9CA3AF]">
                                    <p class="mb-0.5">Last updated</p>
                                    <p class="font-medium text-[#E5E7EB]">
                                        <h:outputText value="#{customerOffersBean.wallet.updatedAt}">
                                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm"
                                                               timeZone="Asia/Ho_Chi_Minh" />
                                        </h:outputText>
                                    </p>
                                </div>
                                <div class="text-[11px] text-[#9CA3AF]">
                                    <p class="mb-0.5">Tips</p>
                                    <p>Pay in full and on time to receive points automatically.</p>
                                </div>
                            </div>
                        </div>
                    </h:panelGroup>

                    <!-- ❌ Chưa login: hiển thị card yêu cầu đăng nhập -->
                    <h:panelGroup rendered="#{not customerOffersBean.loggedIn}">
                        <div
                                class="card-floating rounded-2xl border border-[rgba(148,163,184,0.5)] bg-[rgba(15,23,42,0.95)] px-4 py-4 shadow-[0_18px_50px_rgba(15,23,42,0.9)] flex flex-col gap-3">
                            <p class="text-xs font-semibold tracking-[0.18em] text-[#9CA3AF] uppercase">
                                Points Overview
                            </p>
                            <p class="text-sm text-[#E5E7EB]">
                                Please log in with your customer account to view your reward points

                                and redeemable offers.
                            </p>
                            <div class="mt-2">
                                <h:link outcome="/login.xhtml"
                                        styleClass="inline-flex items-center justify-center rounded-xl bg-gradient-to-r from-[var(--accent-orange)] to-[var(--accent-gold)] px-4 py-2 text-xs font-semibold text-[#111827] shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all duration-200">
                                    <i data-lucide="log-in" class="w-4 h-4 mr-2"></i>
                                   Log in now
                                </h:link>
                            </div>
                        </div>
                    </h:panelGroup>

                </div>
            </section>

            <!-- MAIN CONTENT -->
            <!-- ❌ Nếu chưa login: chỉ hiện thông báo -->
            <h:panelGroup rendered="#{not customerOffersBean.loggedIn}">
                <div
                        class="mb-6 rounded-2xl border border-dashed border-[rgba(148,163,184,0.9)] bg-white px-6 py-7 text-center text-sm text-[var(--text-muted)] shadow-sm">
                    <p class="mb-2 font-semibold text-[var(--text-main)]">
                      Please log in to use your reward points and redeem vouchers.
                    </p>
                    <p class="text-xs md:text-sm mb-4">
                        The system will automatically add points to paid bookings

                        according to the configuration in the Point Settings section.
                    </p>
                    <h:link outcome="/login.xhtml"
                            styleClass="inline-flex items-center justify-center rounded-full bg-[var(--navy)] px-5 py-2 text-xs font-semibold text-white hover:bg-[var(--navy-dark)] transition">
                        <i data-lucide="log-in" class="w-4 h-4 mr-2"></i>
                        Log in to FeastLink
                    </h:link>
                </div>
            </h:panelGroup>

            <!-- ✅ ĐÃ LOGIN CUSTOMER: hiển thị form như cũ -->
            <h:panelGroup rendered="#{customerOffersBean.loggedIn}">
                <h:form id="offersForm" prependId="false">

                    <!-- Messages -->
                    <h:messages globalOnly="true"
                                styleClass="mb-4 text-sm"
                                errorClass="text-red-500"
                                infoClass="text-emerald-600"
                                warnClass="text-amber-500" />

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

                        <!-- LEFT: WALLET DETAIL + HOW IT WORKS -->
                        <section class="lg:col-span-1 space-y-4">

                            <!-- Wallet detail card -->
                            <div
                                    class="card-floating relative overflow-hidden rounded-[22px] border border-[rgba(148,163,184,0.55)] bg-gradient-to-br from-[var(--navy-dark)] via-[var(--navy)] to-[#020617] shadow-[0_22px_70px_rgba(15,23,42,0.85)]">
                                <div class="pointer-events-none absolute inset-0 opacity-70">
                                    <div class="absolute -top-16 -left-10 w-44 h-44 bg-[rgba(248,250,252,0.10)] blur-3xl"></div>
                                    <div class="absolute -bottom-24 right-0 w-72 h-72 bg-[rgba(212,175,55,0.24)] blur-3xl"></div>
                                </div>

                                <div class="relative p-6 md:p-7">
                                    <div class="flex items-center justify-between mb-3">
                                        <div>
                                            <p class="text-[10px] font-semibold tracking-[0.2em] text-[#9CA3AF] uppercase">
                                                My Points Wallet
                                            </p>
                                            <h2 class="mt-2 text-2xl font-bold text-white">
                                                <h:outputText value="#{customerOffersBean.wallet.currentPoints}">
                                                    <f:convertNumber groupingUsed="true" />
                                                </h:outputText>
                                                <span class="text-sm font-medium text-[#E5E7EB]"> pts</span>
                                            </h2>
                                        </div>
                                        <div
                                                class="inline-flex items-center justify-center rounded-full border border-[rgba(212,175,55,0.7)] bg-[rgba(212,175,55,0.15)] px-3 py-1 text-[11px] font-semibold text-[var(--gold-soft)]">
                                            <i data-lucide="sparkles" class="w-3.5 h-3.5 mr-1"></i>
                                            Gold Tier
                                        </div>
                                    </div>

                                    <p class="text-xs text-[#E5E7EB]/85 mb-4">
                                       Points will be added after your party order is processed.
                                        <strong>confirm</strong> and <strong>full payment</strong>You can use your points

                                    to redeem the vouchers on the right.
                                    </p>

                                    <div
                                            class="flex items-center justify-between rounded-2xl border border-[rgba(31,41,55,0.85)] bg-[rgba(15,23,42,0.7)] px-4 py-3">
                                        <div class="flex items-center gap-3 text-xs text-[#E5E7EB]">
                                            <div
                                                    class="flex h-9 w-9 items-center justify-center rounded-xl bg-[rgba(15,23,42,0.9)] border border-[rgba(212,175,55,0.5)]">
                                                <i data-lucide="calendar-clock" class="w-4 h-4 text-[var(--gold-soft)]"></i>
                                            </div>
                                            <div>
                                                <p class="font-medium">
                                                    Last updated
                                                </p>
                                                <p class="text-[11px] text-[#9CA3AF]">
                                                    <h:outputText value="#{customerOffersBean.wallet.updatedAt}">
                                                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm"
                                                                           timeZone="Asia/Ho_Chi_Minh" />
                                                    </h:outputText>
                                                </p>
                                            </div>
                                        </div>
                                        <div class="text-right text-[11px] text-[#9CA3AF]">
                                            <p>Base earn rate</p>
                                            <p class="font-semibold text-[var(--gold-soft)]">
                                                <h:outputText value="#{customerOffersBean.pointsPerAmount}" /> pts /
                                                <h:outputText value="#{customerOffersBean.amountPerPoint}">
                                                    <f:convertNumber groupingUsed="true" />
                                                </h:outputText>
                                            </p>
                                        </div>
                                    </div>

                                    <!-- (ĐÃ BỎ NÚT +100 TEST POINTS) -->
                                </div>
                            </div>

                            <!-- Info card -->
                            <div
                                    class="rounded-2xl border border-[var(--border)] bg-white px-5 py-4 text-xs text-[var(--text-muted)] space-y-2 shadow-sm">
                                <div class="flex items-center gap-2 text-[var(--gold)]">
                                    <i data-lucide="info" class="w-4 h-4"></i>
                                    <span class="font-semibold text-[var(--text-main)]">How points work</span>
                                </div>
                                <ul class="list-disc pl-5 space-y-1">
                                    <li>Points are awarded after the party order is confirmed. &amp; Full payment.</li>
                                    <li>The voucher on the right only appears when it can be redeemed with points.</li>
                                    <li>Some vouchers have minimum order values ​​or expiration dates.</li>
                                </ul>
                            </div>
                        </section>

                        <!-- RIGHT: OFFERS LIST -->
                        <section class="lg:col-span-2 space-y-4">

                            <div class="flex items-center justify-between gap-3 flex-wrap">
                                <div>
                                    <h2 class="text-lg font-semibold text-[var(--text-main)]">
                                        Available offers
                                    </h2>
                                    <p class="text-xs text-[var(--text-muted)]">
                                       The vouchers can be redeemed using your current points.
                                    </p>
                                </div>
                                <div
                                        class="inline-flex items-center rounded-full bg-[var(--bg-alt)] border border-[var(--border)] px-3 py-1 text-[11px] text-[var(--text-muted)]">
                                    <span class="w-2 h-2 rounded-full bg-[var(--success)] mr-1.5"></span>
                                    Balance:
                                    <span class="ml-1 font-semibold text-[var(--accent-orange)]">
                                        <h:outputText value="#{customerOffersBean.wallet.currentPoints}">
                                            <f:convertNumber groupingUsed="true" />
                                        </h:outputText> pts
                                    </span>
                                </div>
                            </div>

                            <!-- “Voucher unlocked” card -->
                            <h:panelGroup rendered="#{not empty customerOffersBean.lastRedeemedCode}">
                                <div
                                        class="rounded-2xl border border-[rgba(212,175,55,0.7)] bg-gradient-to-r from-[#FEF3C7] via-[#FFFBEB] to-white px-5 py-4 flex flex-col md:flex-row md:items-center gap-3 shadow-[0_12px_30px_rgba(250,204,21,0.25)]">
                                    <div class="flex-1">
                                        <p class="text-xs font-semibold tracking-[0.18em] uppercase text-[var(--accent-orange)]">
                                            Voucher unlocked
                                        </p>
                                        <p class="mt-1 text-sm md:text-base font-semibold text-[var(--text-main)]">
                                            <h:outputText value="#{customerOffersBean.lastRedeemedName}" />
                                        </p>
                                        <p class="mt-1 text-xs text-[var(--text-muted)]">
                                          This is the voucher code you have successfully redeemed. Please save it to use when making your payment.
                                        </p>
                                    </div>
                                    <div class="flex flex-col items-start md:items-end gap-1">
                                        <p class="text-[11px] text-[var(--text-muted)] mb-0.5">Voucher code</p>
                                        <div
                                                class="inline-flex items-center px-4 py-2 rounded-xl bg-[var(--navy-dark)] text-white border border-[rgba(15,23,42,0.2)] font-mono text-sm tracking-[0.16em]">
                                            <h:outputText value="#{customerOffersBean.lastRedeemedCode}" />
                                        </div>
                                        <p class="text-[10px] text-[var(--text-muted)]">
                                          Terms and conditions of the voucher apply.
                                        </p>
                                        <p class="text-[10px] text-[var(--text-muted)]">
                                          Total number of vouchers you have redeemed:&nbsp;
                                            <span class="font-semibold text-[var(--accent-orange)]">
                                                <h:outputText value="#{customerOffersBean.redeemedVoucherCount}" />
                                            </span>
                                        </p>
                                    </div>
                                </div>
                            </h:panelGroup>

                            <!-- No offers -->
                            <h:panelGroup rendered="#{empty customerOffersBean.redeemableOffers}">
                                <div
                                        class="rounded-2xl border border-dashed border-[rgba(148,163,184,0.9)] bg-white px-6 py-8 text-center text-sm text-[var(--text-muted)] shadow-sm">
                                    <p class="mb-1 font-medium text-[var(--text-main)]">
                                        There are no redeemable offers at the moment.
                                    </p>
                                    <p class="text-xs md:text-sm">
                                       Continue booking your parties on FeastLink or come back when there are new promotions.
                                    </p>
                                </div>
                            </h:panelGroup>

                            <!-- Offers -->
                            <h:panelGroup rendered="#{not empty customerOffersBean.redeemableOffers}">
                                <div
                                        class="rounded-2xl border border-[var(--border)] bg-white p-4 md:p-5 shadow-sm">
                                    <div class="space-y-4 max-h-[520px] thin-scroll overflow-y-auto pt-1">
                                        <ui:repeat value="#{customerOffersBean.redeemableOffers}" var="offer">
                                            <div
                                                    class="relative overflow-hidden rounded-2xl border border-[rgba(212,175,55,0.45)] bg-gradient-to-r from-[rgba(255,251,235,0.9)] via-white to-[rgba(249,250,251,1)] px-5 py-4 md:px-6 md:py-5 flex flex-col md:flex-row md:items-center gap-4 shadow-[0_10px_30px_rgba(148,163,184,0.25)]">
                                                <div class="absolute inset-y-0 left-0 w-1.5 bg-gradient-to-b from-[var(--gold)] to-[var(--accent-gold)]"></div>

                                                <!-- main content -->
                                                <div class="relative flex-1 flex flex-col gap-2 md:pl-2">
                                                    <div class="flex items-center gap-2 flex-wrap">
                                                        <!-- Không hiện code, chỉ nói là secret -->
                                                        <span
                                                                class="inline-flex items-center justify-center rounded-full border border-[rgba(212,175,55,0.8)] bg-[rgba(212,175,55,0.12)] px-3 py-1 text-[11px] font-semibold text-[var(--text-main)]">
                                                            <i data-lucide="lock" class="w-3.5 h-3.5 mr-1 text-[var(--gold)]"></i>
                                                            Voucher code hidden – redeem to reveal
                                                        </span>
                                                        <h3 class="text-sm md:text-base font-semibold text-[var(--text-main)]">
                                                            <h:outputText value="#{offer.name}" />
                                                        </h3>
                                                    </div>

                                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-[11px] text-[var(--text-muted)] mt-2">
                                                        <div>
                                                            <p>Discount</p>
                                                            <p class="font-semibold text-[var(--accent-orange)]">
                                                                <ui:fragment rendered="#{offer.discountType eq 'PERCENT'}">
                                                                    <h:outputText value="#{offer.discountValue}" />
                                                                    <span>%</span>
                                                                </ui:fragment>
                                                                <ui:fragment rendered="#{offer.discountType eq 'AMOUNT'}">
                                                                    <h:outputText value="#{offer.discountValue}">
                                                                        <f:convertNumber groupingUsed="true" />
                                                                    </h:outputText>
                                                                    <span> USD</span>
                                                                </ui:fragment>
                                                            </p>
                                                        </div>

                                                        <div>
                                                            <p>Max discount</p>
                                                            <p class="font-semibold">
                                                                <h:panelGroup rendered="#{offer.maxDiscount ne null}">
                                                                    <h:outputText value="#{offer.maxDiscount}">
                                                                        <f:convertNumber groupingUsed="true" />
                                                                    </h:outputText> USD
                                                                </h:panelGroup>
                                                                <h:panelGroup rendered="#{offer.maxDiscount eq null}">
                                                                    —
                                                                </h:panelGroup>
                                                            </p>
                                                        </div>

                                                        <div>
                                                            <p>Min order</p>
                                                            <p class="font-semibold">
                                                                <h:panelGroup rendered="#{offer.minOrderAmount ne null}">
                                                                    <h:outputText value="#{offer.minOrderAmount}">
                                                                        <f:convertNumber groupingUsed="true" />
                                                                    </h:outputText> USD
                                                                </h:panelGroup>
                                                                <h:panelGroup rendered="#{offer.minOrderAmount eq null}">
                                                                    None
                                                                </h:panelGroup>
                                                            </p>
                                                        </div>

                                                        <div>
                                                            <p>Point cost</p>
                                                            <p class="font-semibold text-[var(--success)]">
                                                                <h:outputText value="#{offer.pointCost}" /> pts
                                                            </p>
                                                        </div>
                                                    </div>

                                                    <div class="mt-2 flex flex-wrap items-center gap-3 text-[11px] text-[var(--text-muted)]">
                                                        <div class="flex items-center gap-2">
                                                            <i data-lucide="clock" class="w-3.5 h-3.5"></i>
                                                            <span>
                                                                Valid:
                                                                <h:outputText value="#{offer.startAt}">
                                                                    <f:convertDateTime pattern="dd/MM/yyyy"
                                                                                       timeZone="Asia/Ho_Chi_Minh" />
                                                                </h:outputText>
                                                                –
                                                                <h:outputText value="#{offer.endAt}">
                                                                    <f:convertDateTime pattern="dd/MM/yyyy"
                                                                                       timeZone="Asia/Ho_Chi_Minh" />
                                                                </h:outputText>
                                                            </span>
                                                        </div>
                                                        <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full bg-[var(--bg-alt)] border border-[var(--border)] text-[10px]">
                                                            <span class="w-1.5 h-1.5 rounded-full bg-[var(--accent-orange)]"></span>
                                                            Redeem points to unlock code
                                                        </span>
                                                    </div>
                                                </div>

                                                <!-- Redeem button -->
                                                <div class="relative flex-shrink-0 w-full md:w-auto md:pl-2">
                                                    <h:commandButton value="Redeem now"
                                                                     action="#{customerOffersBean.redeemVoucher(offer)}"
                                                                     styleClass="w-full inline-flex items-center justify-center gap-2 rounded-xl bg-gradient-to-r from-[var(--accent-orange)] to-[var(--accent-gold)] px-5 py-2.5 text-sm font-semibold text-[#111827] shadow-lg shadow-[rgba(249,115,22,0.45)] hover:shadow-xl hover:-translate-y-0.5 transition-all duration-200">
                                                        <i data-lucide="gift" class="w-4 h-4"></i>
                                                    </h:commandButton>
                                                </div>
                                            </div>
                                        </ui:repeat>
                                    </div>
                                </div>
                            </h:panelGroup>
                        </section>
                    </div>
                </h:form>
            </h:panelGroup>

        </div>
    </main>

    <!-- FOOTER -->
    <ui:include src="/layout/footer.xhtml" />

    <script type="text/javascript">
        document.addEventListener("DOMContentLoaded", function () {
            if (window.lucide) {
                window.lucide.createIcons();
            }
        });
    </script>

</h:body>
</html>
