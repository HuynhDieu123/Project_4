<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="jakarta.faces.html"
        xmlns:f="jakarta.faces.core"
        xmlns:ui="jakarta.faces.facelets"
        xmlns:pass="jakarta.faces.passthrough"
        template="/Admin/template.xhtml">

    <ui:define name="title">Cuisine Management</ui:define>

    <ui:define name="content">

        <style>
            :root{
                --bg: #f6f8ff;
                --surface: #ffffff;
                --surface-2: #fbfcff;
                --text: #0f172a;
                --muted: #64748b;
                --border: rgba(148,163,184,.35);

                --p1:#4f46e5;
                --p2:#6366f1;
                --p3:#22c55e;
                --warn:#f59e0b;
                --danger:#ef4444;

                --shadow: 0 18px 50px rgba(2, 6, 23, .10);
                --shadow-soft: 0 10px 25px rgba(2, 6, 23, .08);
                --radius: 22px;
            }

            /* Force bright area even if template is dark */
            .cuisine-page{
                position: relative;
                isolation: isolate;
                max-width: 1240px;
                margin: 0 auto;
                padding: 22px 0 48px;
                font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
                color: var(--text);
                filter: none !important;
                opacity: 1 !important;
            }

            .cuisine-shell{
                position: relative;
                border-radius: 30px;
                padding: 22px;
                background:
                    radial-gradient(900px 320px at 18% 0%, rgba(99,102,241,.22), transparent 55%),
                    radial-gradient(900px 360px at 85% 12%, rgba(34,197,94,.14), transparent 60%),
                    radial-gradient(900px 360px at 60% 110%, rgba(245,158,11,.10), transparent 62%),
                    linear-gradient(180deg, #ffffff, var(--bg));
                border: 1px solid rgba(148,163,184,.25);
                box-shadow: var(--shadow);
                overflow: hidden;
            }

            .topbar{
                display:flex;
                align-items:flex-start;
                justify-content:space-between;
                gap: 16px;
                padding: 6px 6px 18px;
            }
            .title{
                font-size: 28px;
                font-weight: 800;
                letter-spacing: -0.03em;
                line-height: 1.1;
            }
            .subtitle{
                margin-top: 6px;
                font-size: 13px;
                color: var(--muted);
                max-width: 760px;
            }

            .badge{
                display:inline-flex;
                align-items:center;
                gap: 10px;
                padding: 10px 14px;
                border-radius: 999px;
                background: rgba(255,255,255,.9);
                border: 1px solid rgba(148,163,184,.28);
                box-shadow: 0 10px 25px rgba(2,6,23,.08);
                font-size: 11px;
                letter-spacing: .18em;
                text-transform: uppercase;
                color: #334155;
                white-space: nowrap;
            }
            .badge-dot{
                width: 10px;
                height: 10px;
                border-radius: 999px;
                background: linear-gradient(135deg, var(--p1), var(--p2));
                box-shadow: 0 0 0 4px rgba(99,102,241,.16);
            }

            .stats{
                display:flex;
                flex-wrap: wrap;
                gap: 10px;
                padding: 0 6px 18px;
            }
            .chip{
                display:inline-flex;
                align-items:center;
                gap: 10px;
                padding: 10px 12px;
                border-radius: 14px;
                background: rgba(255,255,255,.95);
                border: 1px solid rgba(148,163,184,.25);
                box-shadow: 0 10px 20px rgba(2,6,23,.06);
                min-width: 160px;
            }
            .chip .k{
                font-size: 11px;
                color: var(--muted);
                text-transform: uppercase;
                letter-spacing: .10em;
                font-weight: 700;
            }
            .chip .v{
                font-size: 18px;
                font-weight: 850;
                letter-spacing: -0.02em;
                color: var(--text);
                line-height: 1;
            }
            .chip .pill{
                margin-left: auto;
                font-size: 11px;
                font-weight: 750;
                padding: 6px 10px;
                border-radius: 999px;
                background: rgba(99,102,241,.10);
                color: #3730a3;
                border: 1px solid rgba(99,102,241,.18);
            }
            .pill.green{
                background: rgba(34,197,94,.10);
                color: #166534;
                border-color: rgba(34,197,94,.18);
            }

            .card{
                background: var(--surface);
                border: 1px solid rgba(148,163,184,.25);
                border-radius: 24px;
                padding: 18px;
                box-shadow: var(--shadow-soft);
            }

            .grid{
                display:grid;
                grid-template-columns: minmax(0, 1.7fr) minmax(0, 1.05fr);
                gap: 16px;
                align-items: start;
            }

            .section-title{
                font-size: 12px;
                font-weight: 850;
                color: #0b1220;
                text-transform: uppercase;
                letter-spacing: .12em;
                margin: 4px 0 12px;
                display:flex;
                align-items:center;
                justify-content: space-between;
            }
            .section-title .line{
                height: 1px;
                flex: 1;
                margin-left: 12px;
                background: linear-gradient(90deg, rgba(99,102,241,.40), rgba(34,197,94,.28), rgba(245,158,11,.22), transparent);
            }

            /* Messages */
            .msgWrap{ margin: 0 0 12px; }
            .messages{
                margin: 0;
                padding: 10px 12px;
                list-style: none;
                border-radius: 16px;
                border: 1px solid rgba(239,68,68,.22);
                background: rgba(239,68,68,.07);
                color: #991b1b;
                font-size: 13px;
            }
            .messages li{ margin: 2px 0; }

            /* Inputs and buttons */
            .row{
                display:flex;
                gap: 10px;
                align-items:center;
                margin-bottom: 12px;
                flex-wrap: wrap;
            }

            .input{
                flex: 1;
                min-width: 260px;
                height: 44px;
                padding: 0 14px;
                border-radius: 14px;
                border: 1px solid rgba(148,163,184,.35);
                outline: none;
                font-size: 14px;
                background: #fff;
                transition: .15s ease;
                box-shadow: 0 6px 16px rgba(2,6,23,.04);
            }
            .input:focus{
                border-color: rgba(99,102,241,.75);
                box-shadow: 0 0 0 4px rgba(99,102,241,.16), 0 10px 20px rgba(2,6,23,.06);
            }

            .btn{
                height: 44px;
                padding: 0 16px;
                border-radius: 999px;
                border: 1px solid transparent;
                cursor: pointer;
                font-size: 13px;
                font-weight: 800;
                letter-spacing: .01em;
                display: inline-flex;
                align-items:center;
                justify-content:center;
                gap: 8px;
                transition: .15s ease;
                user-select: none;
                box-shadow: 0 10px 22px rgba(2,6,23,.08);
            }
            .btn:active{ transform: translateY(1px); }

            .btn-primary{
                color: #fff;
                background: linear-gradient(135deg, var(--p1), var(--p2));
            }
            .btn-primary:hover{ filter: brightness(1.03); }

            .btn-ghost{
                background: #fff;
                color: #0f172a;
                border-color: rgba(148,163,184,.35);
            }
            .btn-ghost:hover{
                background: rgba(99,102,241,.06);
                border-color: rgba(99,102,241,.25);
            }

            .btn-danger{
                color: #fff;
                background: linear-gradient(135deg, var(--danger), #dc2626);
            }
            .btn-danger:hover{ filter: brightness(1.03); }

            .btn-sm{
                height: 36px;
                padding: 0 14px;
                font-size: 12px;
                box-shadow: 0 8px 18px rgba(2,6,23,.08);
            }

            /* Table */
            .tableWrap{
                border: 1px solid rgba(148,163,184,.25);
                border-radius: 18px;
                overflow: hidden;
                background: var(--surface-2);
            }

            table{
                width: 100%;
                border-collapse: collapse;
                font-size: 14px;
            }

            thead th{
                background:
                    linear-gradient(180deg, rgba(255,255,255,1), rgba(249,250,251,1));
                text-align: left;
                padding: 12px 12px;
                font-size: 11px;
                text-transform: uppercase;
                letter-spacing: .10em;
                color: #475569;
                border-bottom: 1px solid rgba(148,163,184,.22);
            }

            tbody td{
                padding: 12px 12px;
                border-bottom: 1px solid rgba(148,163,184,.14);
                color: #0f172a;
                vertical-align: middle;
                background: #fff;
            }

            tbody tr:nth-child(even) td{
                background: #fbfcff;
            }

            tbody tr:hover td{
                background: rgba(99,102,241,.06);
            }

            .idCell{
                font-variant-numeric: tabular-nums;
                color: #334155;
                width: 90px;
                font-weight: 750;
            }

            .nameCell{
                font-weight: 850;
                letter-spacing: -0.01em;
            }

            .actions{
                display:flex;
                gap: 10px;
                justify-content:flex-start;
                flex-wrap: wrap;
            }

            .empty{
                padding: 14px 12px;
                color: var(--muted);
                font-size: 13px;
                background: #fff;
            }

            /* Right panel */
            .sticky{
                position: sticky;
                top: 14px;
            }

            .panel{
                border: 1px solid rgba(148,163,184,.25);
                border-radius: 20px;
                background:
                    radial-gradient(600px 240px at 0% 0%, rgba(99,102,241,.10), transparent 55%),
                    radial-gradient(520px 220px at 90% 20%, rgba(34,197,94,.08), transparent 60%),
                    #ffffff;
                padding: 16px;
                box-shadow: 0 16px 34px rgba(2,6,23,.08);
            }

            .label{
                display:block;
                font-size: 13px;
                font-weight: 850;
                color: #0b1220;
                margin-bottom: 8px;
            }
            .req{ color: var(--danger); }

            .hint{
                margin-top: 10px;
                font-size: 12px;
                color: var(--muted);
                line-height: 1.5;
            }

            .fieldErr{
                color: var(--danger);
                font-size: 12px;
                display:block;
                margin-top: 8px;
                font-weight: 650;
            }

            .btnRow{
                margin-top: 14px;
                display:flex;
                gap: 10px;
                flex-wrap: wrap;
            }

            @media (max-width: 1024px){
                .grid{ grid-template-columns: 1fr; }
                .sticky{ position: static; }
                .input{ min-width: 100%; }
            }
        </style>

        <div class="cuisine-page">
            <div class="cuisine-shell">

                <!-- Header -->
                <div class="topbar">
                    <div>
                        <div class="title">Cuisine Management</div>
                        <div class="subtitle">
                            Manage cuisine categories used by restaurants – for example: Vietnamese, Japanese, Korean, buffet...
                        </div>
                    </div>
                    <span class="badge">
                        <span class="badge-dot"></span>
                        CUISINES · ADMIN
                    </span>
                </div>

                <!-- Quick stats (wrap để ajax render được) -->
                <h:panelGroup id="statsWrap" layout="block">
                    <div class="stats">
                        <div class="chip">
                            <div>
                                <div class="k">Total cuisines</div>
                                <div class="v">#{empty cuisineBean.cuisines ? 0 : cuisineBean.cuisines.size()}</div>
                            </div>
                            <span class="pill">Live</span>
                        </div>

                        <div class="chip">
                            <div>
                                <div class="k">Mode</div>
                                <div class="v">
                                    <h:outputText value="#{cuisineBean.currentCuisine.cuisineId == null ? 'Create' : 'Edit'}"/>
                                </div>
                            </div>
                            <span class="pill green">Ready</span>
                        </div>
                    </div>
                </h:panelGroup>

                <!-- Messages: để ngoài 2 form để form nào bấm cũng render được -->
                <h:panelGroup id="msgWrap" layout="block" styleClass="msgWrap">
                    <h:messages id="msgs" globalOnly="true" layout="list" styleClass="messages"/>
                </h:panelGroup>

                <div class="card">
                    <div class="grid">

                        <!-- LEFT: SEARCH + LIST (FORM 1) -->
                        <h:form id="searchForm">
                            <div>
                                <div class="section-title">
                                    <span>Search &amp; list</span>
                                    <span class="line"></span>
                                </div>

                                <div class="row">
                                    <h:inputText id="keyword"
                                                 value="#{cuisineBean.keyword}"
                                                 styleClass="input"
                                                 maxlength="100"
                                                 pass:placeholder="Search cuisines by name..."/>

                                    <h:commandButton value="Search"
                                                     action="#{cuisineBean.search}"
                                                     styleClass="btn btn-primary">
                                        <!-- chỉ validate trong searchForm -->
                                        <f:ajax execute="@form" render=":searchForm :editForm:editPanel :statsWrap :msgWrap"/>
                                    </h:commandButton>

                                    <h:commandButton value="Clear"
                                                     action="#{cuisineBean.clearSearch}"
                                                     immediate="true"
                                                     styleClass="btn btn-ghost">
                                        <f:ajax execute="@this" render=":searchForm :editForm:editPanel :statsWrap :msgWrap"/>
                                    </h:commandButton>
                                </div>

                                <div class="tableWrap">
                                    <table>
                                        <thead>
                                        <tr>
                                            <th style="width:90px;">ID</th>
                                            <th>Cuisine name</th>
                                            <th style="width:240px;">Actions</th>
                                        </tr>
                                        </thead>

                                        <tbody>
                                        <ui:repeat value="#{cuisineBean.cuisines}" var="c">
                                            <tr>
                                                <td class="idCell">#{c.cuisineId}</td>
                                                <td class="nameCell">#{c.name}</td>
                                                <td>
                                                    <div class="actions">
                                                        <h:commandButton value="Edit"
                                                                         action="#{cuisineBean.prepareEdit(c)}"
                                                                         styleClass="btn btn-ghost btn-sm">
                                                            <!-- execute @this để KHÔNG đụng validate form bên phải -->
                                                            <f:ajax execute="@this" render=":editForm:editPanel :statsWrap :msgWrap"/>
                                                        </h:commandButton>

                                                        <h:commandButton value="Delete"
                                                                         action="#{cuisineBean.delete(c)}"
                                                                         styleClass="btn btn-danger btn-sm"
                                                                         onclick="return confirm('Are you sure you want to delete this cuisine?');">
                                                            <f:ajax execute="@this" render=":searchForm :editForm:editPanel :statsWrap :msgWrap"/>
                                                        </h:commandButton>
                                                    </div>
                                                </td>
                                            </tr>
                                        </ui:repeat>

                                        <ui:fragment rendered="#{empty cuisineBean.cuisines}">
                                            <tr>
                                                <td colspan="3" class="empty">
                                                    No cuisines found. Try adjusting your search or add a new cuisine on the right.
                                                </td>
                                            </tr>
                                        </ui:fragment>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </h:form>

                        <!-- RIGHT: CREATE / EDIT (FORM 2) -->
                        <h:form id="editForm">
                            <h:panelGroup id="editPanel" layout="block" styleClass="sticky">
                                <div class="section-title">
                                    <span>
                                        <h:outputText value="#{cuisineBean.currentCuisine.cuisineId == null ?
                                                              'Add new cuisine' : 'Edit cuisine'}"/>
                                    </span>
                                    <span class="line"></span>
                                </div>

                                <div class="panel">
                                    <label class="label">
                                        Cuisine name <span class="req">*</span>
                                    </label>

                                    <h:inputText id="name"
                                                 value="#{cuisineBean.currentCuisine.name}"
                                                 styleClass="input"
                                                 required="true"
                                                 requiredMessage="Cuisine name is required."
                                                 maxlength="100"
                                                 pass:placeholder="e.g. Vietnamese, Japanese, Korean..."/>

                                    <h:message for="name" styleClass="fieldErr"/>

                                    <div class="hint">
                                        Tip: keep names short and consistent. Example: “Vietnamese”, “Japanese”, “Korean”.
                                    </div>

                                    <div class="btnRow">
                                        <h:commandButton
                                                value="#{cuisineBean.currentCuisine.cuisineId == null ? 'Create' : 'Save changes'}"
                                                action="#{cuisineBean.save}"
                                                styleClass="btn btn-primary">
                                            <!-- validate chỉ trong editForm -->
                                            <f:ajax execute="@form" render=":searchForm :editForm:editPanel :statsWrap :msgWrap"/>
                                        </h:commandButton>

                                        <h:commandButton value="Reset form"
                                                         action="#{cuisineBean.prepareCreate}"
                                                         immediate="true"
                                                         styleClass="btn btn-ghost">
                                            <f:ajax execute="@this" render=":editForm:editPanel :statsWrap"/>
                                        </h:commandButton>
                                    </div>
                                </div>
                            </h:panelGroup>
                        </h:form>

                    </div>
                </div>

            </div>
        </div>

    </ui:define>
</ui:composition>
