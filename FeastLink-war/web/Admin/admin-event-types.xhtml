<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="jakarta.faces.html"
                xmlns:ui="jakarta.faces.facelets"
                xmlns:f="jakarta.faces.core"
                xmlns:pt="jakarta.faces.passthrough"
                template="/Admin/template.xhtml">

    <ui:define name="title">
        FeastLink - Manage Event Types
    </ui:define>

    <ui:define name="header">
        <div class="flex flex-col">
            <h1 class="text-2xl font-bold text-slate-900">Event Types</h1>
            <p class="text-sm text-slate-500">
                Create, update, delete and search event types (Birthday, Wedding, Gala...).
            </p>
        </div>
    </ui:define>

    <ui:define name="content">

        <div class="text-slate-900">

            <!-- Messages (wrap để render ajax) -->
            <h:panelGroup id="msgWrap" layout="block">
                <h:messages id="msgs" globalOnly="true" layout="list"
                            styleClass="mb-4 rounded-xl border border-slate-200 bg-white p-3 text-sm text-slate-800" />
            </h:panelGroup>

            <!-- FORM: Create / Edit -->
            <h:form id="editForm" styleClass="mb-6 rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">

                <div class="flex items-center justify-between gap-3">
                    <div>
                        <div class="text-lg font-semibold">
                            #{adminEventTypeBean.editMode ? 'Update event type' : 'Create new event type'}
                        </div>
                        <div class="text-sm text-slate-500">
                            #{adminEventTypeBean.editMode ? 'Edit name then click Update.' : 'Enter name then click Create.'}
                        </div>
                    </div>

                    <h:commandButton value="#{adminEventTypeBean.editMode ? 'New' : 'Clear'}"
                                     action="#{adminEventTypeBean.prepareCreate}"
                                     immediate="true"
                                     styleClass="rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm text-slate-700 hover:bg-slate-50">
                        <!-- không reload + reset local value -->
                        <f:ajax execute="@this" render=":editForm :msgWrap" resetValues="true"/>
                    </h:commandButton>
                </div>

                <div class="mt-4 grid grid-cols-1 gap-3 md:grid-cols-2">
                    <div>
                        <label class="mb-1 block text-sm text-slate-700">Name</label>
                        <h:inputText id="name"
                                     value="#{adminEventTypeBean.name}"
                                     required="true"
                                     requiredMessage="Name is required."
                                     styleClass="w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-slate-900 outline-none focus:border-slate-400" />
                        <h:message for="name" styleClass="mt-1 block text-xs text-red-600" />
                    </div>

                    <div class="flex items-end gap-2">
                        <h:commandButton value="#{adminEventTypeBean.editMode ? 'Update' : 'Create'}"
                                         action="#{adminEventTypeBean.save}"
                                         styleClass="rounded-xl bg-slate-900 px-5 py-2 text-sm font-semibold text-white hover:opacity-90">
                            <!-- ajax để khỏi “nhảy”, update cả list luôn -->
                            <f:ajax execute="@form" render=":editForm :listForm :msgWrap"/>
                        </h:commandButton>

                        <!-- ✅ CANCEL FIX -->
                        <h:commandButton value="Cancel"
                                         action="#{adminEventTypeBean.cancel}"
                                         immediate="true"
                                         styleClass="rounded-xl border border-slate-200 bg-white px-5 py-2 text-sm text-slate-700 hover:bg-slate-50">
                            <!-- chỉ chạy nút, reset field, không reload -->
                            <f:ajax execute="@this" render=":editForm :msgWrap" resetValues="true"/>
                        </h:commandButton>
                    </div>
                </div>
            </h:form>

            <!-- LIST + SEARCH -->
            <h:form id="listForm" styleClass="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">

                <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
                    <div class="flex flex-col gap-2 md:flex-row md:items-center">
                        <h:inputText id="kw"
                                     value="#{adminEventTypeBean.keyword}"
                                     pt:placeholder="Search by name..."
                                     styleClass="w-full md:w-80 rounded-xl border border-slate-200 bg-white px-4 py-2 text-slate-900 outline-none focus:border-slate-400" />

                        <div class="flex gap-2">
                            <h:commandButton value="Search"
                                             action="#{adminEventTypeBean.search}"
                                             immediate="true"
                                             styleClass="rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm text-slate-700 hover:bg-slate-50">
                                <f:ajax execute="@form" render=":listForm"/>
                            </h:commandButton>

                            <h:commandButton value="Reset"
                                             action="#{adminEventTypeBean.clearSearch}"
                                             immediate="true"
                                             styleClass="rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm text-slate-700 hover:bg-slate-50">
                                <f:ajax execute="@this" render=":listForm"/>
                            </h:commandButton>
                        </div>
                    </div>

                    <h:commandButton value="Add new"
                                     action="#{adminEventTypeBean.prepareCreate}"
                                     immediate="true"
                                     styleClass="rounded-xl bg-slate-900 px-5 py-2 text-sm font-semibold text-white hover:opacity-90">
                        <f:ajax execute="@this" render=":editForm :msgWrap" resetValues="true"/>
                    </h:commandButton>
                </div>

                <div class="mt-4 overflow-x-auto rounded-xl border border-slate-200">
                    <h:dataTable value="#{adminEventTypeBean.items}" var="e"
                                 styleClass="w-full text-left text-sm"
                                 rowClasses="border-b border-slate-200, border-b border-slate-200">

                        <h:column>
                            <f:facet name="header">
                                <div class="bg-slate-50 px-4 py-3 text-xs font-semibold uppercase tracking-wider text-slate-600">
                                    ID
                                </div>
                            </f:facet>
                            <div class="px-4 py-3 text-slate-800">#{e.eventTypeId}</div>
                        </h:column>

                        <h:column>
                            <f:facet name="header">
                                <div class="bg-slate-50 px-4 py-3 text-xs font-semibold uppercase tracking-wider text-slate-600">
                                    Name
                                </div>
                            </f:facet>
                            <div class="px-4 py-3 font-medium text-slate-900">#{e.name}</div>
                        </h:column>

                        <h:column>
                            <f:facet name="header">
                                <div class="bg-slate-50 px-4 py-3 text-xs font-semibold uppercase tracking-wider text-slate-600">
                                    Actions
                                </div>
                            </f:facet>

                            <div class="px-4 py-3 flex gap-2">
                                <h:commandButton value="Edit"
                                                 action="#{adminEventTypeBean.prepareEdit(e)}"
                                                 immediate="true"
                                                 styleClass="rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50">
                                    <f:ajax execute="@this" render=":editForm :msgWrap" resetValues="true"/>
                                </h:commandButton>

                                <h:commandButton value="Delete"
                                                 action="#{adminEventTypeBean.delete(e)}"
                                                 immediate="true"
                                                 onclick="return confirm('Delete this event type?');"
                                                 styleClass="rounded-lg border border-red-200 bg-white px-3 py-1.5 text-xs text-red-700 hover:bg-red-50">
                                    <f:ajax execute="@this" render=":listForm :msgWrap"/>
                                </h:commandButton>
                            </div>
                        </h:column>

                    </h:dataTable>
                </div>

                <h:panelGroup rendered="#{empty adminEventTypeBean.items}">
                    <div class="mt-3 rounded-xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-700">
                        No event types found.
                    </div>
                </h:panelGroup>

            </h:form>
        </div>

    </ui:define>
</ui:composition>
