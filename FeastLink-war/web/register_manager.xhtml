<!DOCTYPE html>
<html lang="vi"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="jakarta.faces.facelets">

    <h:head>
        <meta charset="UTF-8" />
        <title>FeastLink – Đăng ký nâng cấp tài khoản Nhà hàng</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet"
              type="text/css"
              href="#{request.contextPath}/css/register_manager.css" />
          <!-- Tailwind CDN -->
        <script src="https://cdn.tailwindcss.com"></script>

        <!-- Lucide Icons CDN -->
        <script src="https://unpkg.com/lucide@latest"></script>
    </h:head>
    <h:body>
        <div id="top"></div>

        <!-- HEADER -->
        <ui:include src="layout/header.xhtml" />
        <div class="shell">

            <!-- SIDEBAR -->
            <aside class="sidebar">
                
                <div class="logo-row">
                    <h:graphicImage library="images"
                                    name="feastlink-logo.png"
                                    styleClass="logo-mark" />
                    <div>
                        <div class="logo-text-main">FeastLink</div>
                        <div class="logo-text-sub">Banquet &amp; Catering Platform</div>
                    </div>
                </div>

                <div class="sidebar-title">Nâng cấp tài khoản</div>
                <div class="sidebar-caption">
                    Gửi yêu cầu trở thành <span>Restaurant Manager</span> để quản lý hồ sơ và đơn đặt tiệc của nhà hàng bạn.
                </div>

                <div class="sidebar-steps">
                    <a href="#s1" class="sidebar-step-link">
                        <div class="sidebar-step">
                            <div class="step-badge step-badge--active">1</div>
                            <div>
                                <div class="step-label-main">Thông tin quản lý</div>
                                <div class="step-label-sub">Họ tên, email đăng nhập</div>
                            </div>
                        </div>
                    </a>
                    <a href="#s2" class="sidebar-step-link">
                        <div class="sidebar-step">
                            <div class="step-badge">2</div>
                            <div>
                                <div class="step-label-main">Thông tin nhà hàng</div>
                                <div class="step-label-sub">Tên, logo, địa điểm</div>
                            </div>
                        </div>
                    </a>
                    <a href="#s3" class="sidebar-step-link">
                        <div class="sidebar-step">
                            <div class="step-badge">3</div>
                            <div>
                                <div class="step-label-main">Điều kiện nhận tiệc</div>
                                <div class="step-label-sub">Số khách, ngày đặt trước</div>
                            </div>
                        </div>
                    </a>
                    <a href="#s4" class="sidebar-step-link">
                        <div class="sidebar-step">
                            <div class="step-badge">4</div>
                            <div>
                                <div class="step-label-main">Gửi Admin duyệt</div>
                                <div class="step-label-sub">Kiểm duyệt &amp; kích hoạt</div>
                            </div>
                        </div>
                    </a>
                </div>

                <div class="sidebar-footer">
                    Sau khi gửi yêu cầu, <span>Admin FeastLink</span> sẽ xem xét và duyệt trong 1–3 ngày làm việc.
                </div>
            </aside>

            <!-- MAIN CONTENT -->
            <main class="content">
                <div class="content-inner">

                    <!-- JSF GLOBAL MESSAGES -->
                    <h:messages id="globalMsg"
                                layout="list"
                                globalOnly="true"
                                infoClass="msg msg-info"
                                errorClass="msg msg-error"
                                warnClass="msg msg-warn" />

                    <div class="content-header">
                        <div class="content-title-block">
                            <h1>Đăng ký nâng cấp tài khoản Nhà hàng</h1>
                            <p>Điền thông tin bên dưới để yêu cầu nâng cấp tài khoản hiện tại của bạn lên Restaurant Manager.</p>
                        </div>
                        <div class="status-pill">Trạng thái: Draft request</div>
                    </div>

                    <div class="info-banner">
                        <div class="info-text">
                            <strong>Quy trình duyệt hồ sơ:</strong> Sau khi gửi yêu cầu, đội ngũ FeastLink sẽ xem xét thông tin nhà hàng, có thể liên hệ lại để xác minh thêm 
                            (qua email hoặc điện thoại). Khi hồ sơ được duyệt, tài khoản hiện tại của bạn sẽ được <strong>nâng cấp lên Restaurant Manager</strong>.
                        </div>
                    </div>

                    <!-- QUAN TRỌNG: multipart/form-data để upload file -->
                    <h:form id="registerForm" enctype="multipart/form-data">
                        <!-- 1. THÔNG TIN QUẢN LÝ -->
                        <section class="section-card" id="s1">
                            <div class="section-header">
                                <div>
                                    <div class="section-title">1. Thông tin Quản lý nhà hàng</div>
                                    <div class="section-caption">Thông tin này dùng để đăng nhập và nhận thông báo từ FeastLink.</div>
                                </div>
                            </div>

                            <div class="field-grid-2">
                                <div class="field">
                                    <label for="managerName">Họ và tên quản lý *</label>
                                    <h:inputText id="managerName"
                                                 value="#{registerRestaurantManagerBean.managerName}"
                                                 required="true"
                                                 requiredMessage="Vui lòng nhập Họ và tên quản lý.">
                                        <f:passThroughAttribute name="placeholder" value="Ví dụ: Alex Tran" />
                                    </h:inputText>
                                    <h:message for="managerName" styleClass="msg-field-error" />
                                </div>
                                <div class="field">
                                    <label for="managerPhone">Số điện thoại *</label>
                                    <h:inputText id="managerPhone"
                                                 value="#{registerRestaurantManagerBean.managerPhone}"
                                                 required="true"
                                                 requiredMessage="Vui lòng nhập Số điện thoại.">
                                        <f:passThroughAttribute name="placeholder" value="Ví dụ: 0901 234 567" />
                                    </h:inputText>
                                    <h:message for="managerPhone" styleClass="msg-field-error" />
                                </div>
                                <div class="field">
                                    <label for="managerEmail">Email đăng nhập *</label>
                                    <h:inputText id="managerEmail"
                                                 value="#{registerRestaurantManagerBean.managerEmail}"
                                                 required="true"
                                                 requiredMessage="Vui lòng nhập Email.">
                                        <f:passThroughAttribute name="type" value="email" />
                                        <f:passThroughAttribute name="placeholder" value="example@restaurant.com" />
                                    </h:inputText>
                                    <div class="hint">Sẽ dùng email hiện tại của bạn nếu bạn đang đăng nhập.</div>
                                    <h:message for="managerEmail" styleClass="msg-field-error" />
                                </div>
                                <div class="field">
                                    <label for="managerRole">Chức vụ tại nhà hàng</label>
                                    <h:inputText id="managerRole"
                                                 value="#{registerRestaurantManagerBean.managerRole}">
                                        <f:passThroughAttribute name="placeholder" value="Ví dụ: General Manager" />
                                    </h:inputText>
                                </div>
                            </div>
                        </section>

                        <!-- 2. THÔNG TIN NHÀ HÀNG -->
                        <section class="section-card" id="s2">
                            <div class="section-header">
                                <div>
                                    <div class="section-title">2. Thông tin nhà hàng</div>
                                    <div class="section-caption">Thông tin hiển thị cho khách khi nhà hàng được kích hoạt trên FeastLink.</div>
                                </div>
                            </div>

                            <div class="field-grid-2">
                                <div class="field">
                                    <label for="restaurantName">Tên nhà hàng *</label>
                                    <h:inputText id="restaurantName"
                                                 value="#{registerRestaurantManagerBean.restaurantName}"
                                                 required="true"
                                                 requiredMessage="Vui lòng nhập Tên nhà hàng.">
                                        <f:passThroughAttribute name="placeholder" value="Tên nhà hàng của bạn" />
                                    </h:inputText>
                                    <h:message for="restaurantName" styleClass="msg-field-error" />
                                </div>
                                <div class="field">
                                    <label for="restaurantBrandName">Tên thương hiệu (nếu có)</label>
                                    <h:inputText id="restaurantBrandName"
                                                 value="#{registerRestaurantManagerBean.restaurantBrandName}">
                                        <f:passThroughAttribute name="placeholder" value="Brand / Group" />
                                    </h:inputText>
                                </div>
                            </div>

                            <div class="field-grid-2 margin-top-12">
                                <div class="field">
                                    <label for="restaurantAddress">Địa chỉ chi tiết *</label>
                                    <h:inputText id="restaurantAddress"
                                                 value="#{registerRestaurantManagerBean.restaurantAddress}"
                                                 required="true"
                                                 requiredMessage="Vui lòng nhập Địa chỉ chi tiết.">
                                        <f:passThroughAttribute name="placeholder" value="Số nhà, đường, phường/xã" />
                                    </h:inputText>
                                    <h:message for="restaurantAddress" styleClass="msg-field-error" />
                                </div>
                                <div class="field-grid-2">
                                    <div class="field">
                                        <label for="city">Thành phố *</label>
                                        <h:selectOneMenu id="city"
                                                         value="#{registerRestaurantManagerBean.city}"
                                                         required="true"
                                                         requiredMessage="Vui lòng chọn Thành phố.">
                                            <f:selectItem itemLabel="Chọn thành phố" itemValue="" />
                                            <f:selectItems value="#{registerRestaurantManagerBean.cityList}"
                                                           var="c"
                                                           itemLabel="#{c}"
                                                           itemValue="#{c}" />
                                            <f:ajax listener="#{registerRestaurantManagerBean.onCityChange}"
                                                    render="area" />
                                        </h:selectOneMenu>
                                        <h:message for="city" styleClass="msg-field-error" />
                                    </div>
                                    <div class="field">
                                        <label for="area">Khu vực *</label>
                                        <h:selectOneMenu id="area"
                                                         value="#{registerRestaurantManagerBean.area}"
                                                         required="true"
                                                         requiredMessage="Vui lòng chọn Khu vực.">
                                            <f:selectItem itemLabel="Chọn khu vực" itemValue="" />
                                            <f:selectItems value="#{registerRestaurantManagerBean.areaList}"
                                                           var="a"
                                                           itemLabel="#{a}"
                                                           itemValue="#{a}" />
                                        </h:selectOneMenu>
                                        <h:message for="area" styleClass="msg-field-error" />
                                    </div>
                                </div>
                            </div>

                            <div class="field-grid-2 margin-top-12">
                                <div class="field">
                                    <label for="description">Mô tả nhà hàng</label>
                                    <h:inputTextarea id="description"
                                                     value="#{registerRestaurantManagerBean.description}">
                                        <f:passThroughAttribute name="placeholder"
                                                                value="Giới thiệu ngắn về phong cách, không gian và điểm nổi bật của nhà hàng." />
                                    </h:inputTextarea>
                                </div>

                                <!-- UPLOAD LOGO -->
                                <div class="field">
                                    <label for="logoFile">Logo nhà hàng *</label>
                                    <div class="upload-logo">
                                        <div>Ảnh vuông tối thiểu <strong>600 x 600px</strong></div>

                                        <h:inputFile id="logoFile"
                                                     value="#{registerRestaurantManagerBean.logoFile}">
                                        </h:inputFile>
                                        <div class="hint">
                                            Chọn file JPG/PNG từ máy. Logo sẽ được lưu vào thư mục
                                            <code>resources/images/upload_file</code> của hệ thống.
                                        </div>
                                        <h:message for="logoFile" styleClass="msg-field-error" />

                                        <!-- PREVIEW LOGO: KHUNG CỐ ĐỊNH -->
                                        <h:panelGroup rendered="#{not empty registerRestaurantManagerBean.logoUrl}">
                                            <div class="logo-preview">
                                                <div class="logo-preview-inner">
                                                    <img src="#{request.contextPath}#{registerRestaurantManagerBean.logoUrl}"
                                                         alt="Logo preview" />
                                                </div>
                                                <div class="logo-preview-caption">
                                                    Xem trước logo (tự thu nhỏ theo khung)
                                                </div>
                                            </div>
                                        </h:panelGroup>
                                    </div>
                                </div>
                            </div>

                            <div class="field-grid-3 margin-top-12">
                                <div class="field">
                                    <label for="taxCode">Mã số thuế doanh nghiệp (nếu có)</label>
                                    <h:inputText id="taxCode"
                                                 value="#{registerRestaurantManagerBean.taxCode}">
                                        <f:passThroughAttribute name="placeholder" value="Ví dụ: 0312 xxx xxx" />
                                    </h:inputText>
                                    <div class="hint">Thông tin dùng để xuất hóa đơn và đối soát thanh toán.</div>
                                </div>
                                <div class="field">
                                    <label for="fanpage">Fanpage / Mạng xã hội</label>
                                    <h:inputText id="fanpage"
                                                 value="#{registerRestaurantManagerBean.fanpage}">
                                        <f:passThroughAttribute name="placeholder"
                                                                value="Link Facebook / Instagram / TikTok" />
                                    </h:inputText>
                                </div>
                            </div>

                            <div class="field-grid-3 margin-top-12">
                                <div class="field">
                                    <label for="openTime">Giờ mở cửa</label>
                                    <h:inputText id="openTime"
                                                 value="#{registerRestaurantManagerBean.openTime}">
                                        <f:passThroughAttribute name="placeholder" value="Ví dụ: 09:00" />
                                    </h:inputText>
                                </div>
                                <div class="field">
                                    <label for="closeTime">Giờ đóng cửa</label>
                                    <h:inputText id="closeTime"
                                                 value="#{registerRestaurantManagerBean.closeTime}">
                                        <f:passThroughAttribute name="placeholder" value="Ví dụ: 22:00" />
                                    </h:inputText>
                                </div>
                                <div class="field">
                                    <label for="servingStyle">Hình thức phục vụ chính</label>
                                    <h:selectOneMenu id="servingStyle"
                                                     value="#{registerRestaurantManagerBean.servingStyle}">
                                        <f:selectItem itemLabel="Chọn hình thức" itemValue="#{null}" />
                                        <f:selectItem itemLabel="Buffet" itemValue="Buffet" />
                                        <f:selectItem itemLabel="Set menu" itemValue="Set menu" />
                                        <f:selectItem itemLabel="A la carte" itemValue="A la carte" />
                                        <f:selectItem itemLabel="Tea break / Cocktail" itemValue="Tea break / Cocktail" />
                                    </h:selectOneMenu>
                                </div>
                            </div>

                            <div class="field margin-top-12">
                                <label>Loại tiệc phục vụ chính *</label>

                                <!-- Hidden bind với bean, JS sẽ set value vào đây -->
                                <h:inputHidden id="mainEventTypeInput"
                                               value="#{registerRestaurantManagerBean.mainEventType}"
                                               required="true"
                                               requiredMessage="Vui lòng chọn Loại tiệc phục vụ chính." />

                                <div class="tags-row" id="eventTypeTags">
                                    <button type="button" class="tag" data-value="Wedding">Wedding</button>
                                    <button type="button" class="tag" data-value="Birthday">Birthday</button>
                                    <button type="button" class="tag" data-value="Corporate / Gala">Corporate / Gala</button>
                                    <button type="button" class="tag" data-value="Conference">Conference</button>
                                    <button type="button" class="tag" data-value="Private Dining">Private Dining</button>
                                </div>

                                <h:message for="mainEventTypeInput" styleClass="msg-field-error" />

                                <div class="hint">
                                    Bạn có thể cập nhật chi tiết loại sự kiện, sảnh tiệc và menu sau khi được duyệt.
                                </div>
                            </div>
                        </section>

                        <!-- 3. ĐIỀU KIỆN NHẬN TIỆC -->
                        <section class="section-card" id="s3">
                            <div class="section-header">
                                <div>
                                    <div class="section-title">3. Điều kiện nhận tiệc (tóm tắt)</div>
                                    <div class="section-caption">Thiết lập các điều kiện cơ bản để FeastLink gợi ý phù hợp cho khách.</div>
                                </div>
                            </div>

                            <div class="field-grid-3">
                                <div class="field">
                                    <label for="minGuests">Số khách tối thiểu *</label>
                                    <h:inputText id="minGuests"
                                                 value="#{registerRestaurantManagerBean.minGuests}"
                                                 required="true"
                                                 requiredMessage="Vui lòng nhập Số khách tối thiểu.">
                                        <f:passThroughAttribute name="type" value="number" />
                                        <f:passThroughAttribute name="min" value="0" />
                                        <f:passThroughAttribute name="placeholder" value="Ví dụ: 50" />
                                    </h:inputText>
                                    <h:message for="minGuests" styleClass="msg-field-error" />
                                </div>
                                <div class="field">
                                    <label for="maxGuests">Số khách tối đa (dự kiến)</label>
                                    <h:inputText id="maxGuests"
                                                 value="#{registerRestaurantManagerBean.maxGuests}">
                                        <f:passThroughAttribute name="type" value="number" />
                                        <f:passThroughAttribute name="min" value="0" />
                                        <f:passThroughAttribute name="placeholder" value="Ví dụ: 300" />
                                    </h:inputText>
                                </div>
                                <div class="field">
                                    <label for="minDays">Số ngày đặt trước tối thiểu *</label>
                                    <h:inputText id="minDays"
                                                 value="#{registerRestaurantManagerBean.minDays}"
                                                 required="true"
                                                 requiredMessage="Vui lòng nhập Số ngày đặt trước tối thiểu.">
                                        <f:passThroughAttribute name="type" value="number" />
                                        <f:passThroughAttribute name="min" value="0" />
                                        <f:passThroughAttribute name="placeholder" value="Ví dụ: 7" />
                                    </h:inputText>
                                    <div class="hint">Tính theo ngày trước ngày diễn ra tiệc.</div>
                                    <h:message for="minDays" styleClass="msg-field-error" />
                                </div>
                            </div>
                        </section>

                        <!-- 4. ĐIỀU KHOẢN & CAM KẾT -->
                        <section class="section-card" id="s4">
                            <div class="section-header">
                                <div>
                                    <div class="section-title">4. Điều khoản &amp; Cam kết</div>
                                    <div class="section-caption">Vui lòng đọc kỹ các điều khoản trước khi gửi yêu cầu nâng cấp tài khoản.</div>
                                </div>
                            </div>

                            <div class="field">
                                <div class="hint" style="margin-bottom:8px;">
                                    Khi gửi yêu cầu trở thành <strong>Restaurant Manager</strong> trên FeastLink, bạn xác nhận và đồng ý rằng:
                                </div>
                                <ul class="terms-list">
                                    <li>Thông tin nhà hàng và thông tin liên hệ bạn cung cấp là <strong>chính xác, đầy đủ và cập nhật</strong>.</li>
                                    <li>Nhà hàng của bạn tuân thủ các quy định pháp luật hiện hành về <strong>an toàn vệ sinh thực phẩm, phòng cháy chữa cháy</strong> và các giấy phép kinh doanh liên quan.</li>
                                    <li>Bạn chịu trách nhiệm về <strong>chất lượng dịch vụ, thực đơn, giá cả</strong> và trải nghiệm của khách hàng.</li>
                                    <li>Bạn đồng ý với <strong>chính sách hủy / hoàn tiền</strong> và các quy định xử lý khiếu nại, đánh giá của khách hàng theo quy định của FeastLink.</li>
                                    <li>Bạn cho phép FeastLink sử dụng thông tin, hình ảnh và nội dung mô tả nhà hàng để <strong>hiển thị, quảng bá</strong> trên nền tảng.</li>
                                    <li>FeastLink có quyền <strong>xem xét, tạm ẩn hoặc ngừng hiển thị</strong> nhà hàng nếu phát hiện thông tin sai lệch hoặc vi phạm chính sách.</li>
                                </ul>
                            </div>

                            <div class="field margin-top-6">
                                <label class="terms-label">
                                    <h:selectBooleanCheckbox id="termsCheckbox"
                                                             value="#{registerRestaurantManagerBean.acceptedTerms}" />
                                    <span>
                                        Tôi xác nhận đã đọc, hiểu và đồng ý với Điều khoản &amp; Cam kết dành cho
                                        <strong>Đối tác Nhà hàng FeastLink</strong>.
                                    </span>
                                </label>
                            </div>
                        </section>

                        <div class="form-footer">
                            <div class="security-note">
                                <div class="shield">✓</div>
                                <div>
                                    Yêu cầu sẽ được gửi đến Admin FeastLink. Nhà hàng chỉ hiển thị sau khi được <strong>phê duyệt.</strong>
                                </div>
                            </div>
                            <div class="btn-row">
                                <h:commandButton value="Hủy"
                                                 styleClass="btn-secondary"
                                                 action="#{registerRestaurantManagerBean.cancel}" />
                                <h:commandButton id="submitBtn"
                                                 value="Gửi yêu cầu nâng cấp"
                                                 styleClass="btn-primary"
                                                 action="#{registerRestaurantManagerBean.submit}" />
                            </div>
                        </div>
                    </h:form>
                </div>

                <!-- FAQ + FOOTER -->
                <div class="faq-wrapper">
                    <div class="faq-card">
                        <div class="faq-title">
                            Câu hỏi thường gặp khi đăng ký làm đối tác FeastLink
                        </div>
                        <ul class="faq-list">
                            <li><strong>Mất bao lâu để được duyệt?</strong> Thông thường 1–3 ngày làm việc. Trường hợp cần bổ sung giấy tờ, đội ngũ FeastLink sẽ liên hệ trực tiếp.</li>
                            <li><strong>Nhà hàng được tính phí / hoa hồng như thế nào?</strong> Phí hoa hồng cố định là <strong>2% trên tổng giá trị đơn đặt tiệc</strong> đã thanh toán thành công thông qua FeastLink.</li>
                            <li><strong>Tôi có thể chỉnh sửa thông tin nhà hàng sau này không?</strong> Có. Sau khi được nâng cấp, bạn có thể cập nhật hình ảnh, menu, giá, sảnh tiệc và các điều kiện đặt chỗ.</li>
                            <li><strong>Khi nào nhà hàng của tôi hiển thị cho khách?</strong> Sau khi hồ sơ được duyệt và bạn cấu hình ít nhất một gói tiệc / menu hợp lệ, nhà hàng sẽ được bật trạng thái hiển thị.</li>
                        </ul>
                    </div>
                </div>
            </main>
        </div>
          <ui:include src="layout/footer.xhtml" />

        <!-- JS: step highlight, khóa nút nếu chưa tick điều khoản, chọn loại tiệc -->
        <script type="text/javascript">
            //<![CDATA[
            function initStepHighlight() {
                var links = document.querySelectorAll('.sidebar-step-link');
                var badges = document.querySelectorAll('.step-badge');

                for (var i = 0; i < links.length; i++) {
                    (function (idx) {
                        links[idx].addEventListener('click', function () {
                            for (var j = 0; j < badges.length; j++) {
                                if (j === idx) {
                                    badges[j].classList.add('step-badge--active');
                                } else {
                                    badges[j].classList.remove('step-badge--active');
                                }
                            }
                        });
                    })(i);
                }
            }

            function initTermsLock() {
                var cb = document.querySelector('input[id$="termsCheckbox"]');
                var btn = document.querySelector('input[id$="submitBtn"]');
                if (!cb || !btn)
                    return;

                function sync() {
                    btn.disabled = !cb.checked;
                    if (btn.disabled) {
                        btn.style.opacity = "0.6";
                        btn.style.cursor = "not-allowed";
                    } else {
                        btn.style.opacity = "1";
                        btn.style.cursor = "pointer";
                    }
                }

                cb.addEventListener('change', sync);
                sync();
            }

            function initEventTypeTags() {
                var container = document.getElementById('eventTypeTags');
                var hiddenInput = document.querySelector('input[id$="mainEventTypeInput"]');
                if (!container || !hiddenInput)
                    return;

                var buttons = container.querySelectorAll('button.tag');

                function syncFromHidden() {
                    var val = hiddenInput.value;
                    for (var i = 0; i < buttons.length; i++) {
                        var bVal = buttons[i].getAttribute('data-value');
                        if (bVal === val) {
                            buttons[i].classList.add('tag--active');
                        } else {
                            buttons[i].classList.remove('tag--active');
                        }
                    }
                }

                for (var i = 0; i < buttons.length; i++) {
                    (function (btn) {
                        btn.addEventListener('click', function () {
                            var v = btn.getAttribute('data-value');
                            hiddenInput.value = v;
                            syncFromHidden();
                        });
                    })(buttons[i]);
                }

                // Sync lại khi page load (trường hợp đã có dữ liệu)
                syncFromHidden();
            }

            window.addEventListener('load', function () {
                initStepHighlight();
                initTermsLock();
                initEventTypeTags();
            });
            //]]>
        </script>

    </h:body>
</html>
